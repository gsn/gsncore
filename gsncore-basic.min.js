/*!
 * gsncore
 * version 1.7.32
 * gsncore repository
 * Build date: Thu Mar 31 2016 14:16:00 GMT+0300 (Belarus Standard Time)
 */
(function(){"use strict";function e(){var e=f.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(n>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}return!1}function t(e,t){function r(){(void 0===this.readyState||"complete"===this.readyState)&&"function"==typeof t&&t()}0===e.indexOf("//")&&(e="http:"+e),"file"===(n.location||{}).protocol&&(e=e.replace("https://","http://"));var o=document.createElement("script");o.type="text/javascript",o.src=e,t&&(o.onload=r,o.onreadystatechange=r),document.body.appendChild(o)}var n=this,r=n.gsn,o={},i=Array.prototype,s=Object.prototype,a=i.slice,c=s.hasOwnProperty,u=i.forEach,l=i.map,d=i.some,g=i.indexOf,p=Object.keys,f=function(e){return e instanceof f?e:this instanceof f?(this._wrapped=e,this):new f(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=f),exports.gsn=f):n.gsn=f,f.root=n,f.VERSION="1.0.4",f.previousGsn=r,f.config={AuthServiceUrl:"/proxy/auth",StoreServiceUrl:"/proxy/store",ProfileServiceUrl:"/proxy/profile",ShoppingListServiceUrl:"/proxy/shoppinglist",LoggingServiceUrl:"/proxy/logging",YoutechCouponUrl:"/proxy/couponut",RoundyProfileUrl:"/proxy/roundy",MidaxServiceUrl:"/proxy/midax",ApiUrl:"",Version:(new Date).getTime(),EmailRegex:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,ServiceUnavailableMessage:"We are unable to process your request at this time.",UseLocalStorage:!1,ContentBaseUrl:"/asset",ChainId:0,ChainName:"Grocery Shopping Network",DfpNetworkId:"/6394/digitalstore.test",GoogleTagId:null,GoogleAnalyticAccountId1:null,GoogleAnalyticAccountId2:null,GoogleSiteVerificationId:null,RegistrationFromEmailAddress:"tech@grocerywebsites.com",FacebookDisable:!1,FacebookAppId:null,FacebookPermission:null,GoogleSiteSearchCode:null,DisableLimitedTimeCoupons:!1,Theme:null,HomePage:null,StoreList:null,AllContent:null,hasDigitalCoupon:!1,hasStoreCoupon:!1,hasPrintableCoupon:!1,hasRoundyProfile:!1,hasInit:!1},f.identity=function(e){return e},f.userAgent=n.navigator.userAgent,f.browser={isIE:e(),userAgent:f.userAgent,isMobile:/iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/gi.test(f.userAgent),isAndroid:/(android)/gi.test(f.userAgent),isIOS:/iP(hone|od|ad)/gi.test(f.userAgent)};var h=f.each=f.forEach=function(e,t,n){if(null!==f.isNull(e,null))if(u&&e.forEach===u)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,i=e.length;i>r;r++)if(t.call(n,e[r],r,e)===o)return}else for(var s=f.keys(e),a=0,c=s.length;c>a;a++)if(t.call(n,e[s[a]],s[a],e)===o)return};f.map=f.collect=function(e,t,n){var r=[];return null===f.isNull(e,null)?r:l&&e.map===l?e.map(t,n):(h(e,function(e,o,i){r.push(t.call(n,e,o,i))}),r)},f.extend=function(e){return h(a.call(arguments,1),function(t){"undefined"!=typeof t&&f.forEach(t,function(t,n){null!==f.isNull(t,null)&&(e[n]=t)})}),e};var m=f.some=f.any=function(e,t,n){t=t||f.identity;var r=!1;return null===f.isNull(e,null)?r:d&&e.some===d?e.some(t,n):(h(e,function(e,i,s){return r||(r=t.call(n,e,i,s))?o:null}),!!r)};f.contains=f.include=function(e,t){return null===f.isNull(e,null)?!1:g&&e.indexOf===g?-1!=e.indexOf(t):m(e,function(e){return e===t})},f.applyConfig=function(e,t){if(!f.config.hasInit){f.config.hasInit=!0,f.extend(f.config,e),f.config.HomePage=f.parsePartialContentData(f.config.HomePage);var n=f.config.SiteMenu||"";"string"==typeof n&&(f.config.SiteMenu=n.length>10?JSON.parse(n):[],f.forEach(f.config.SiteMenu,function(e){e.Position=parseInt(e.Position),f.forEach(e.SubMenu,function(e){e.Position=parseInt(e.Position)})}))}var r=!f.isNull(t,f.config.dontUseProxy);if(r&&f.browser.isAndroid){var o=f.browser.userAgent,i=parseFloat(o.slice(o.indexOf("Android")+8));if(i>4)return;r=!1}r||f.forEach(f.config,function(e,t){"string"==typeof e&&"ApiUrl"!=e&&e.indexOf("/proxy/")>=0&&(f.config[t]=e.replace("/proxy/",f.config.ApiUrl+"/"))}),e.useProxy=r},f.isNull=function(e,t){return"undefined"==typeof e||null===e?t:e},f.isNaN=function(e,t){return isNaN(e)?t:e},f.sortOn=function(e,t){return null===f.isNull(e,null)?null:e.length<=0?[]:(e.sort("string"==typeof e[0][t]?function(e,n){return(e[t]&&e[t].toLowerCase())<(n[t]&&n[t].toLowerCase())?-1:(e[t]&&e[t].toLowerCase())>(n[t]&&n[t].toLowerCase())?1:0}:function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:0}),e)},f.cleanKeyword=function(e){var t=e.replace(/[^a-zA-Z0-9]+/gi,"_").replace(/^[_]+/gi,"");return null!==f.isNull(t.toLowerCase,null)&&(t=t.toLowerCase()),t},f.groupBy=function(e,t,n){if(null===f.isNull(e,null))return[];var r=[],o={};f.forEach(e,function(e){var n=e[t],r=o[n];null===f.isNull(r,null)&&(r={key:n,items:[]},o[n]=r),r.items.push(e)});var i=0;return f.forEach(o,function(e){e.$idx=i++,r.push(e),n&&n(e)}),f.sortOn(r,"key")},f.mapObject=function(e,t){var n={};return e&&(f.isNull(e.length,-1)<0?n[e[t]]=e:f.map(e,function(e){var r=e[t],o=n[r];o?("[object Array]"!==Object.prototype.toString.call(o)&&(o=[o]),o.push(e)):o=e,n[r]=o})),n},f.keys=p||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)f.has(e,n)&&t.push(n);return t},f.has=function(e,t){return c.call(e,t)},f.del=function(e,t){e[t]=void 0;try{delete e[k]}catch(n){var r={};return f.each(e,function(e,n){n!=t&&(r[n]=e)}),r}return e},f.getUrl=function(e,t){t=f.isNull(t,"");var n=(t.indexOf("?")>0?"&":"?")+"nocache="+f.config.Version;return(e+t+n).replace(/(\\\\)+/gi,"\\")},f.getContentUrl=function(e){return f.getUrl(f.config.ContentBaseUrl,e)},f.getThemeUrl=function(e){var t=f.config.ContentBaseUrl;return f.isNull(f.config.SiteTheme,"").length>0&&(t=t.replace("/"+f.config.ChainId,"/"+f.config.SiteTheme)),f.getUrl(t,e)},f.getContentServiceUrl=function(e){return f.getApiUrl()+"/Content"+f.isNull(e,"")},f.getApiUrl=function(){return""!==f.config.ApiUrl?f.config.ApiUrl:"/proxy"},f.setTheme=function(e){f.config.SiteTheme=e},f.goUrl=function(){},f.initAnalytics=function(e){e.settings&&(e.settings.trackRelativePath=!0);var t=f.isNull(f.config.GoogleAnalyticAccountId1,"").length>0;n.ga&&(t&&ga("create",f.config.GoogleAnalyticAccountId1,"auto"),ga("require","displayfeatures")),e.registerPageTrack(function(e){n.ga&&ga("send","pageview",e),n._tk&&_tk.pageview()}),e.registerEventTrack(function(e,t){if(t.value){var r=parseInt(t.value,10);t.value=isNaN(r)?0:r}if(n.ga&&ga("send","event",t.category,e,t.label,t.value,{nonInteraction:1}),n._tk){var o={},i=t.item;i&&(i.BrandName&&(o.bn=i.BrandName),i.ProductCode&&(o.sku=i.ProductCode),!i.ic&&i.ItemId&&(o.ic=i.ItemId),i.ShoppingListItemId&&(o.slic=i.ShoppingListItemId),i.ShelfName&&(o.shf=i.ShelfName),i.DepartmentName&&(o.dpt=i.DepartmentName),i.CategoryName&&!i.ec&&(i.ec||(o.ec=i.CategoryName)),i.AisleName&&(o.ailse=i.AisleName)),_tk.event(t.category,e,t.label,t.property,t.value,o)}})},f.init=function(e,t,r,o,i,s){f.initAngular(r,t,e,o,i),f.initAnalytics(s),"undefined"!=typeof n._tk&&n._tk.util.Emitter(f)},f.initAngular=function(e,t,r,o,i){f.applyConfig(n.globalConfig.data||{}),f.config.ContentBaseUrl=n.location.port>1e3&&n.location.port<5e3?"/asset/"+f.config.ChainId:f.config.ContentBaseUrl,f.config.hasRoundyProfile=[215,216,217,218].indexOf(f.config.ChainId)>-1,f.config.DisableLimitedTimeCoupons=215===f.config.ChainId,f.config.Theme&&f.setTheme(f.config.Theme),e.enabled(!f.browser.isIE&&n.location.protocol.indexOf("http")>=0),t.resourceUrlWhitelist(f.config.SceWhiteList||["self","http://*.gsn.io/**","http://*.*.gsn.io/**","http://*.*.*.gsn.io/**","http://*.gsn2.com/**","https://*.gsn2.com/**","http://*.gsngrocers.com/**","https://*.gsngrocers.com/**","http://*.gsnretailer.com/**","https://*.gsnretailer.com/**","http://*.brickinc.net/**","https://*.brickinc.net/**","http://localhost:*/**","file:///**"]),"undefined"!=typeof r&&r.html5Mode(!0).hashPrefix("!"),"undefined"!=typeof o&&(o.interceptors.push("gsnAuthenticationHandler"),o.defaults.useXDomain=!0,o.defaults.headers.common["X-Requested-With"]=null),"undefined"!=typeof FastClick&&FastClick.attach(document.body),"undefined"!=typeof i&&(f.config.FacebookDisable?f.config.FacebookAppId=null:i.init(f.config.facebookVersion?{appId:f.config.FacebookAppId,xfbml:!0,version:f.config.facebookVersion}:f.config.FacebookAppId))},n.globalConfig&&(f.config.ApiUrl=f.isNull(n.globalConfig.apiUrl,"").replace(/\/+$/g,""),""==f.config.ApiUrl&&(f.config.ApiUrl="/proxy")),f.loadScripts=function(e,n){function r(){if(o.length<=0)"function"==typeof n&&n();else{var e=o[0];o.splice(0,1),t(e,r)}}if(f.isNull(e.length,0)<=0)"function"==typeof n&&n();else{"string"==typeof e&&(e=[e]);var o=[].concat(e);r()}},f.loadIframe=function(e,t){var n=document.createElement("iframe");if(e[0].appendChild(n),n.contentWindow)n.contentWindow.contents=t,n.src='javascript:window["contents"]';else{var r=n.document;n.contentDocument&&(r=n.contentDocument),r.open(),r.write(t),r.close()}return n},f.parsePartialContentData=function(e){null===f.isNull(e,null)&&(e={ConfigData:{},ContentData:{},ContentList:[]});var t=e;if(t.ConfigData)return t;var n=[],r=[];if(t.Contents){f.forEach(t.Contents,function(e){e.IsMetaData?n.push(e):r.push(e)}),t.Contents=null,t.ConfigData=f.mapObject(n,"Headline"),t.ContentData=f.mapObject(r,"SortBy");for(var o=[],i=0;i<r.length;i++)o.push(r[i]);o.length>0&&(t.ContentList=f.sortOn(o,"SortBy"))}return t}}).call(this),function(e,t){"use strict";function n(n,o,i,s,a,c,u,l){function d(){var e=g(),t=m.isNull(e.expires_dt,0)>0&&e.expires_dt>(new Date).getTime();if(t)return null;var n={grant_type:"anonymous",client_id:m.getChainId(),access_type:"offline"};return"undefined"!=typeof e.refresh_token&&(n.grant_type="refresh_token",n.refresh_token=e.refresh_token),n}function g(){return m.isNull(v.accessToken,{})}function p(e){if(v.accessToken=e||{},e){var t=parseInt(m.isNull(e.user_id,0));m.isNaN(t,0)>0&&n.$broadcast("gsnevent:profile-setid",t),"anonymous"==e.grant_type&&h(e)}}function f(){return m.isNull(u.anonymousToken,{})}function h(e){var t=m.isNull(e,{});u.anonymousToken=t}var m={previousDefer:null},v=u;return n[r]=m,m.gsn=e,e.$api=m,m.isNull=e.isNull,m.isNaN=e.isNaN,m.sortOn=e.sortOn,m.groupBy=e.groupBy,m.mapObject=e.mapObject,m.forEach=t.forEach,m.extend=e.extend,m.keys=e.keys,m.getContentUrl=function(t){return l.trustAsResourceUrl(e.getContentUrl(t))},m.getThemeUrl=function(t){return l.trustAsResourceUrl(e.getThemeUrl(t))},m.cleanKeyword=e.cleanKeyword,m.loadIframe=e.loadIframe,m.loadScripts=e.loadScripts,m.userAgent=e.userAgent,m.browser=e.browser,m.parsePartialContentData=e.parsePartialContentData,m.del=e.del,m.getConfig=function(){return e.config},m.getApiUrl=e.getApiUrl,m.getStoreUrl=function(){return e.config.StoreServiceUrl},m.getContentServiceUrl=function(t){var n=e.getContentServiceUrl("/"+t+"/"+m.getChainId()+"/"+m.isNull(m.getSelectedStoreId(),"0")+"/");return e.config.useProxy?(n=n.replace("clientapi.gsn2.com/","/").replace("https://","").replace("http://",""),n=n.replace("clientapix.gsn2.com/","/").replace("/api/v1","/proxy")):n.replace("clientapi.gsn2.com/","clientapi.gsngrocers.com/").replace("https://",c.protocol()+"://")},m.getDefaultLayout=function(t){return e.config.DefaultLayout?l.trustAsResourceUrl(e.config.DefaultLayout):t},m.getYoutechCouponUrl=function(){return e.config.YoutechCouponUrl},m.getRoundyProfileUrl=function(){return e.config.RoundyProfileUrl},m.getProductServiceUrl=function(){return e.config.ProductServiceUrl},m.getShoppingListApiUrl=function(){return e.config.ShoppingListServiceUrl},m.getProfileApiUrl=function(){return e.config.ProfileServiceUrl},m.getLoggingApiUrl=function(){return e.config.LoggingServiceUrl},m.getMidaxServiceUrl=function(){return e.config.MidaxServiceUrl},m.getUseLocalStorage=function(){return m.isNull(e.config.UseLocalStorage,!1)},m.getVersion=function(){return e.config.Version},m.getGoogleSiteSearchCode=function(){return e.config.GoogleSiteSearchCode},m.getGoogleSiteVerificationId=function(){return e.config.GoogleSiteVerificationId},m.isBetween=function(e,t,n){return e>t&&n>e},m.getFacebookPermission=function(){return m.isNull(e.config.FacebookPermission,"email")},m.getGoogleAnalyticAccountId1=function(){return m.isNull(e.config.GoogleAnalyticAccountId1,"")},m.getGoogleAnalyticAccountId2=function(){return m.isNull(e.config.GoogleAnalyticAccountId2,"")},m.getEmailRegEx=function(){return e.config.EmailRegex},m.getDfpNetworkId=function(){return e.config.DfpNetworkId},m.getServiceUnavailableMessage=function(){return e.config.ServiceUnavailableMessage},m.getChainId=function(){return e.config.ChainId},m.getChainName=function(){return e.config.ChainName},m.getHomeData=function(){return e.config.HomePage},m.getRegistrationFromEmailAddress=function(){return e.config.RegistrationFromEmailAddress},m.htmlFind=function(e,n){return t.element("<div>"+e+"</div>").find(n).length},m.equalsIgnoreCase=function(e,n){return t.lowercase(e)==t.lowercase(n)},m.toLowerCase=function(e){return t.lowercase(e)},m.goUrl=function(e,n){try{t.element(".modal").modal("hide")}catch(r){}if(n=m.isNull(n,""),"_blank"==n)return void o.open(e,"");if("_reload"!=n&&"_self"!=n)i(function(){c.url(e)},5);else if(o.top)try{o.top.location=e}catch(r){o.location=e}else o.location=e},m.reload=function(){m.goUrl(c.url(),"_reload")},e.goUrl=m.goUrl,m.clearSelection=function(e){t.forEach(e,function(e){e.selected=!1})},m.getBindableItem=function(e){var r=t.copy(e);if(r.NewQuantity=r.Quantity||1,n.gsnProfile){var o=n.gsnProfile.getShoppingList();if(o){var i=o.getItem(r);return i||r}}return r},m.updateBindableItem=function(e){if(e.ItemId&&n.gsnProfile){var t=n.gsnProfile.getShoppingList();t&&(e.OldQuantity=e.Quantity,e.Quantity=parseInt(e.NewQuantity),t.syncItem(e))}},m.doSiteSearch=function(e){m.goUrl("/search?q="+encodeURIComponent(e))},m.doItemSearch=function(e){m.goUrl("/product/search?q="+encodeURIComponent(e))},m.decodeServerUrl=function(e){return decodeURIComponent((e+"").replace(/\s+$/,"").replace(/\s+/gi,"-").replace(/(.aspx)$/,""))},m.parseStoreSpecificContent=function(n){var r={},o=[],i=n,s=e.config.StoreList.length,a=m.isNull(m.getSelectedStoreId(),0);n&&n.Id&&(i=[n]);var c=0;t.forEach(i,function(e){var n=m.isNull(e.StoreIds,[]);return 0>=c&&n.length<=0&&(r=e),c++,0>=a?void(s==e.StoreIds.length&&(r=e)):void t.forEach(n,function(t){a==t&&(r=e,o.push(e))})});var u=s;return o.length>1&&t.forEach(o,function(e){e.StoreIds.length>1&&e.StoreIds.length<u&&(u=e.StoreIds.length,r=e)}),r},m.getThemeContent=function(e){return m.parseStoreSpecificContent(m.getHomeData().ContentData[e])},m.getThemeConfig=function(e){return m.parseStoreSpecificContent(m.getHomeData().ConfigData[e])},m.getThemeConfigDescription=function(e,t){var n=m.getThemeConfig(e).Description;return m.isNull(n,t)},m.getFullPath=function(e,t){var n=(m.isNull(e,"")+"").replace(/$\/+/gi,"");return n.indexOf("http")>-1?e:("localhost"==c.host()&&(t=!0),n=c.protocol()+"://"+c.host()+(t?":"+c.port():"")+("/"+n).replace(/(\/\/)+/gi,"/"))},m.getPageCount=function(e,t){return e=e||[],Math.ceil(e.length/t)||1},m.getSelectedStoreId=function(){return v.storeId||0},m.setSelectedStoreId=function(e,t,r){var o=parseInt(e);m.isNaN(o,0)<=0&&(e=null);var s=v.storeId;v.storeId=e,n.$broadcast("gsnevent:store-setid",{newValue:e,oldValue:s}),t&&i(function(){m.goUrl(t,"_reload")},r||500)},m.getProfileId=function(){var e=g();return m.isNaN(parseInt(m.isNull(e.user_id,0)),0)},m.getShoppingListId=function(){return m.isNull(v.shoppingListId,0)},m.setShoppingListId=function(e,t){v.shoppingListId=m.isNull(e,0),t||n.$broadcast("gsnevent:shoppinglist-setid",e)},m.getApiHeaders=function(){var e=g(),t={site_id:m.getChainId(),store_id:m.getSelectedStoreId(),profile_id:m.getProfileId(),access_token:e.access_token,"Content-Type":"application/json"};return t},m.isAnonymous=function(){var e=g();return"anonymous"==m.isNull(e.grant_type,"")},m.isLoggedIn=function(){var e=g();return"password"==m.isNull(e.grant_type,"")},e.isLoggedIn=m.isLoggedIn,e.getUserId=m.getProfileId,m.logOut=function(){var e=m.getProfileId(),t=f();p(t),m.isNull(t.expires_dt,0)<=0&&m.getAccessToken(),n.$broadcast("gsnevent:logout",{ProfileId:e})},m.doAuthenticate=function(t){t&&(t.username||(t.username=m.getProfileId())),a.post(e.config.AuthServiceUrl+"/Token2",t,{headers:{"Content-Type":"application/json",shopping_list_id:m.getShoppingListId()}}).success(function(e){e.expires_dt=(new Date).getTime()+1e3*e.expires_in,p(e);var r=m.previousDefer;r&&(m.previousDefer=null,r.resolve(e)),n.$broadcast("gsnevent:login-success",{success:!0,payload:t,response:e})}).error(function(e){var r="refresh_token"==t.grant_type&&m.isNull(e.ExceptionMessage,"").indexOf("expired")>0;r||n.$broadcast("gsnevent:login-failed",{success:!0,payload:t,response:e})})},m.setAccessToken=p,m.getAccessToken=function(){var e=null===m.isNull(m.previousDefer,null)?s.defer():m.previousDefer,t=d();return null===m.isNull(t,null)?(m.previousDefer=null,i(function(){e.resolve({success:!0,response:g()})},10),e.promise):null!==m.isNull(m.previousDefer,null)?m.previousDefer.promise:(m.previousDefer=e,m.doAuthenticate(t),e.promise)},m.http=function(e,t,n){if(e.response)i(function(){e.deferred.resolve(e.response)},50);else if(null===m.isNull(e.deferred,null)){e.deferred=s.defer();var r=function(t){e.response={success:!0,response:t},e.deferred.resolve(e.response)},o=function(t){e.response={success:!1,response:t},e.deferred.resolve(e.response)};t.indexOf("/undefined")>0?o("Client error: invalid request."):m.getAccessToken().then(function(){e.url=t,n?a.post(t,n,{headers:m.getApiHeaders()}).success(r).error(o):a.get(t,{headers:m.getApiHeaders()}).success(r).error(o)})}return e.deferred.promise},m.httpGetOrPostWithCache=m.http,m.isValidCaptcha=function(t,n){var r=s.defer();return a.post(e.config.AuthServiceUrl+"/ValidateCaptcha",{challenge:t,response:n},{headers:{"Content-Type":"application/json"}}).success(function(e){r.resolve("true"==e)}).error(function(){r.resolve(!1)}),r.promise},m.goBack=function(){i(function(){o.history.back()},10)},m.initApp=function(){n.appState="initializing",n.getContentUrl=m.getContentUrl,n.getThemeUrl=m.getThemeUrl,n.getContentServiceUrl=m.getContentServiceUrl;var t=m.getHomeData().ConfigData;if(t){var r=t.layout;r&&(n.defaultLayout=e.getThemeUrl("/views/layout"+r.Description+"/layout.html"))}var o=g(),s=m.isNull(o.expires_dt,0)>0&&o.expires_dt>(new Date).getTime();if(!s){var a=f();p(a)}i(function(){n.appState="ready"},200)},m.onevent=function(e){n.$on("gsnevent:*",e)},n.$on("gsnevent:auth-expired",function(){var e=g();e.access_token&&(e.expires_dt=0,p(e)),m.getAccessToken()}),n.$on("gsnevent:auth-invalidrefresh",function(){var e=g();"anonymous"==e.grant_type&&h(),m.logOut(),m.reload()}),m}t.module("facebook",[]).provider("Facebook",function i(){return{init:function(){},$get:function(){return new i}}}),t.module("ui.map",[]),t.module("ui.event",[]),t.module("ui.utils",[]),t.module("ui.keypress",[]),t.module("chieffancypants.loadingBar",[]);var r="gsnApi",o=t.module("gsn.core",["ngRoute","ngSanitize","facebook","angulartics","ui.event"]);o.config(["$locationProvider","$sceDelegateProvider","$sceProvider","$httpProvider","FacebookProvider","$analyticsProvider",function(t,n,r,o,i,s){e.init(t,n,r,o,i,s)}]).run(["$rootScope","gsnGlobal","gsnApi","$window",function(e,n,r,o){var i=t.element("head"),s='<!--[if lt IE 10]>\n<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/2.2.0/es5-shim.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/json2/20130526/json2.min.js"></script>\n<![endif]-->';i.append(s),e.siteMenu=r.getConfig().SiteMenu,e.win=o,n.init(!0)}]),o.service(r,["$rootScope","$window","$timeout","$q","$http","$location","$localStorage","$sce",n])}(gsn,angular),function(){function e(e,t,n,r){angular.forEach(t.split(" "),function(t){window.google.maps.event.addListener(n,t,function(n){r.triggerHandler("map-"+t,n),e.$$phase||e.$apply()})})}function t(t,r){n.directive(t,[function(){return{restrict:"A",link:function(n,o,i){n.$watch(i[t],function(t){t&&e(n,r,t,o)})}}}])}var n=angular.module("gsn.core");n.value("uiMapConfig",{}).directive("uiMap",["uiMapConfig","$parse","$timeout","gsnApi",function(t,n,r){var o="bounds_changed center_changed click dblclick drag dragend dragstart heading_changed idle maptypeid_changed mousemove mouseout mouseover projection_changed resize rightclick tilesloaded tilt_changed zoom_changed",i=t||{};return{restrict:"A",link:function(t,s,a){function c(){var u=(window.google||{}).maps||{};if("undefined"==typeof u.Geocoder||"undefined"==typeof u.InfoWindow||"undefined"==typeof u.Map)return void r(c,100);if(!a.uiOptions)return void r(c,100);var l=angular.extend({},i,t.$eval(a.uiOptions)),d=new window.google.maps.Map(s[0],l),g=n(a.uiMap);g.assign(t,d),e(t,o,d,s)}c()}}}]),n.value("uiMapInfoWindowConfig",{}).directive("uiMapInfoWindow",["uiMapInfoWindowConfig","$parse","$compile","$timeout",function(t,n,r,o){var i="closeclick content_change domready position_changed zindex_changed",s=t||{};return{link:function(t,a,c){function u(){var l=(window.google||{}).maps||{};if("undefined"==typeof l.Geocoder||"undefined"==typeof l.InfoWindow||"undefined"==typeof l.Map)return void o(u,100);var d=angular.extend({},s,t.$eval(c.uiOptions));d.content=a[0];var g=n(c.uiMapInfoWindow),p=g(t);p||(p=new window.google.maps.InfoWindow(d),g.assign(t,p)),e(t,i,p,a),a.replaceWith("<div></div>");var f=p.open;p.open=function(e,n,o,i,s,c){r(a.contents())(t),f.call(p,e,n,o,i,s,c)}}u()}}}]),t("uiMapMarker","animation_changed click clickable_changed cursor_changed dblclick drag dragend draggable_changed dragstart flat_changed icon_changed mousedown mouseout mouseover mouseup position_changed rightclick shadow_changed shape_changed title_changed visible_changed zindex_changed"),t("uiMapPolyline","click dblclick mousedown mousemove mouseout mouseover mouseup rightclick"),t("uiMapPolygon","click dblclick mousedown mousemove mouseout mouseover mouseup rightclick"),t("uiMapRectangle","bounds_changed click dblclick mousedown mousemove mouseout mouseover mouseup rightclick"),t("uiMapCircle","center_changed click dblclick mousedown mousemove mouseout mouseover mouseup radius_changed rightclick"),t("uiMapGroundOverlay","click dblclick")}(),function(e){"use strict";var t=e.module("gsn.core");t.service("vcRecaptchaService",["$timeout","$log","$q","$window","gsnApi",function(e,t,n,r,o){var i,s;return{create:function(t,n,r,a){function c(){Recaptcha.create(n,t,a)}if(i=r,a.callback=r,"undefined"==typeof Recaptcha){if(e(c,500),s)return;s=!0;var u="//www.google.com/recaptcha/api/js/recaptcha_ajax.js";return void o.loadScripts([u],c)}c()},reload:function(t){Recaptcha.reload(t&&"t"),e(i,1e3)},data:function(){return{response:Recaptcha.get_response(),challenge:Recaptcha.get_challenge()}},destroy:function(){Recaptcha.destroy()}}}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("vcRecaptcha",["$log","$timeout","vcRecaptchaService",function(t,n,r){return{restrict:"A",require:"?ngModel",link:function(t,o,i,s){if(!i.hasOwnProperty("key")||40!==i.key.length)throw'You need to set the "key" attribute to your public reCaptcha key. If you don\'t have a key, please get one from https://www.google.com/recaptcha/admin/create';var a,c,u=function(){s&&s.$setViewValue({response:a.val(),challenge:c.val()})},l=function(){var t=o.find("input");c=e.element(t[0]),a=e.element(t[1]),u()},d=function(){l(),a.bind("keyup",function(){t.$apply(u)}),s&&(s.$render=function(){a.val(s.$viewValue.response),c.val(s.$viewValue.challenge)}),o.bind("click",function(){n(function(){t.$apply(l)},1e3)})};r.create(o[0],i.key,d,{tabindex:i.tabindex,theme:i.theme,lang:i.lang||null})}}}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.filter("defaultIf",["gsnApi",function(){return function(e,t,n){var r=t;return"function"==typeof t&&(r=t()),r?n:e}}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.filter("groupBy",["gsnApi",function(e){return function(t,n){return e.groupBy(t,n)}}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.filter("pagingFilter",function(){return function(e,t,n){return e?e.slice(n*t,(n+1)*t):[]}})}(angular),function(e){"use strict";var t=e.module("gsn.core");t.filter("tel",function(){return function(e,t,n){if(!e)return"";n=n?new RegEx(n):/(\d{3})(\d{3})(\d{4})/;var r=(""+e).replace(/\D/g,"");return r.replace(n,t||"$1-$2-$3")}})}(angular),function(e){"use strict";var t=e.module("gsn.core");t.filter("range",[function(){return function(e,t,n){t=parseInt(t),n=parseInt(n);for(var r=t;n>r;r++)e.push(r);return e}}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.filter("removeAspx",["gsnApi",function(e){return function(t){return e.isNull(t,"").replace(/(.aspx\"|.gsn\")+/gi,'"')}}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.filter("replaceWith",function(){return function(e,t,n,r){var o=new RegExp(t,n);return e.replace(o,r)}})}(angular),function(e){"use strict";var t=e.module("gsn.core");t.filter("truncate",[function(){return function(e,t,n,r){if(!e)return"";if(n=parseInt(n,10),!n)return e;if(e.length<=n)return e;if(e=e.substr(0,n),t){var o=e.lastIndexOf(" ");-1!=o&&(e=e.substr(0,o))}return e+(r||" …")}}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.filter("trustedHtml",["gsnApi","$sce",function(e,t){return function(e){return t.trustAsHtml(e)}}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.filter("unescapeHtml",[function(){return function(e,t){return t?t(e):unescape(e)}}])}(angular),function(e){"use strict";function t(e,t,n,r,o){var i={},s=o.bricktag;return s?(s.on("clickRecipe",function(n){e(function(){t.url("/recipe/"+n.detail.RecipeId)})}),s.on("clickProduct",function(t){e(function(){var e=t.detail;if(e){var o={Quantity:r.isNaN(parseInt(e.Quantity),1),ItemTypeId:7,Description:r.isNull(e.Description,"").replace(/^\s+/gi,""),CategoryId:e.CategoryId,BrandName:e.BrandName,AdCode:e.AdCode};n.addItem(o)}})}),s.on("clickLink",function(n){e(function(){var e=n.detail;if(e){var o=r.isNull(e.Url,""),i=r.isNull(e.Target,"");"_blank"==i||(o.indexOf("/")<0&&(o="/"+o),t.url(o))}})}),i):i}var n="gsnAdvertising";e.module("gsn.core").service(n,["$timeout","$location","gsnProfile","gsnApi","$window",t])}(angular),function(e){"use strict";function t(t,n,r,o,i,s){function a(){if("undefined"==typeof gcprinter){if(r.log("waiting for gcprinter..."),o(a,500),h.loadingScript)return;h.loadingScript=!0;var i="//cdn.gsngrocers.com/script/gcprinter/gcprinter.min.js";return void n.loadScripts([i],a)}h.activated||(h.activated=!0,gcprinter.on("printed",function(r,i){o(function(){var o=n.isNull(i.ErrorCoupons,[]);o.length>0&&e.forEach(o,function(t){e.element(".coupon-message-"+t.CouponId).html(t.ErrorMessage)}),t.$broadcast("gsnevent:gcprinter-printed",r,i)},5)}),gcprinter.on("printing",function(n){o(function(){e.element(m.join(",")).html("Printing..."),t.$broadcast("gsnevent:gcprinter-printing",n)},5)}),gcprinter.on("printfail",function(n,r){o(function(){e.element(m.join(",")).html("gsn-server"==n?"Print limit reached...":"gsn-cancel"==n?"Print canceled...":"Print failed..."),t.$broadcast("gsnevent:gcprinter-printfail",r)},5)}),gcprinter.on("initcomplete",function(){h.isScriptReady=!0,c(),t.$broadcast("gsnevent:gcprinter-initcomplete")}))}function c(){return n.isMobile?void 0:"undefined"==typeof gcprinter?void o(c,500):h.isScriptReady?void o(l,5):void gcprinter.init()}function u(t){return(t||[]).length<=0?void 0:0==i.getProcessDate()?void o(function(){u(t)},1e3):(v.length=0,m.length=0,e.forEach(t,function(e){if(null!==n.isNull(e,null)){var t=e;null===n.isNull(e.ProductCode,null)&&(t=i.getCoupon(e.ItemId,e.ItemTypeId)||e),m.push(".coupon-message-"+t.ProductCode),v.push(t.ProductCode)}}),o(function(){e.element(m.join(",")).html("Checking, please wait...")},5),gcprinter.isReady?void o(l,5):void c())}function l(){if(p())if(gcprinter.isPluginBlocked())t.$broadcast("gsnevent:gcprinter-blocked");else if(f()){if(v.length>0){var r=n.getChainId();e.forEach(v,function(e){s.addPrinted(e)}),gcprinter.print(r,v)}}else t.$broadcast("gsnevent:gcprinter-not-supported");else t.$broadcast("gsnevent:gcprinter-not-found"),h.isDetecting||(h.isDetecting=!0,d())}function d(){return p()?void g():void(gcprinter.isChrome?gcprinter.detectWithSocket(2e3,g,d,1):setTimeout(function(){gcprinter.checkInstall(d,d)},2e3))}function g(){h.pluginFound=!0,o(function(){t.$broadcast("gsnevent:gcprinter-ready")},5),gcprinter.init(!0)}function p(){return gcprinter.isChrome?h.pluginFound:gcprinter.hasPlugin()}function f(){var e=!1;try{e=gcprinter.isPrinterSupported()}catch(t){e=!0}return e}var h={print:u,init:c,loadingScript:!1,isScriptReady:!1,activated:!1,isDetecting:!1,pluginFound:!1},m=[],v=[];return a(),h}var n="gsnCouponPrinter";e.module("gsn.core").service(n,["$rootScope","gsnApi","$log","$timeout","gsnStore","gsnProfile","$window",t])}(angular),function(e){"use strict";function t(t,n,r,o,i,s,a,c,u){function l(e,t,o){var i=n.getShoppingListId();if(t.ShoppingListId==i){var s=r.getCategories()[o.CategoryId];f.addDept(s.CategoryName),p.doRefresh()}}function d(){p.isIE&&(f.minSecondBetweenRefresh=15)}function g(){(t.gvm||{}).adsCollapsed=!1,f.refresh(p.actionParam,p.forceRefresh),p.forceRefresh=!1}var p={forceRefresh:!0,actionParam:null,doRefresh:u(g,500)},f=s.bricktag||{addDept:function(){},refresh:function(){},setDefault:function(){}};return t.$on("gsnevent:shoppinglistitem-updating",l),t.$on("gsnevent:shoppinglistitem-removing",l),t.$on("gsnevent:shoppinglist-loaded",function(){var t=o.getShoppingList();if(t){var i=o.getShoppingList().allItems(),s=r.getCategories();e.forEach(i,function(e){if(null!==n.isNull(e.CategoryId,null)&&s[e.CategoryId]){var t=s[e.CategoryId].CategoryName;f.addDept(t)}})}}),t.$on("$locationChangeSuccess",function(){var t=e.lowercase(n.isNull(c.path(),""));o.getProfile().then(function(e){var r=n.isLoggedIn();f.setDefault({page:t,storeid:n.getSelectedStoreId(),consumerid:o.getProfileId(),isanon:!r,loyaltyid:e.response.ExternalId})}),p.forceRefresh=!0,p.doRefresh()}),t.$on("gsnevent:loadads",function(e){p.actionParam={evtname:e.name},p.doRefresh()}),t.$on("gsnevent:digitalcircular-pagechanging",function(){p.doRefresh()}),d(),p}var n="gsnDfp";e.module("gsn.core").service(n,["$rootScope","gsnApi","gsnStore","gsnProfile","$sessionStorage","$window","$timeout","$location","debounce",t])}(angular,window.Gsn),function(e){"use strict";function t(t,n,r,o,i,s,a,c,u,l,d){function g(o,g){function f(e,t,n){var o=e.name.replace("gsnevent:","-");n&&(l.eventTrack(i.isNull(n.action,"")+o,n),n.timedload&&r(function(){c.$broadcast("gsnevent:loadads")},parseInt(n.timedload)))}return p.hasInit?p:(p.hasInit=!0,o&&s.initialize(),i.gsn.$rootScope=c,g=g||c,g.defaultLayout=i.getDefaultLayout(i.getThemeUrl("/views/layout.html")),g.currentLayout=g.defaultLayout,g.currentPath="/",g.gvm={loginCounter:0,menuInactive:!1,shoppingListActive:!1,profile:{},noCircular:!0,reloadOnStoreSelection:!1,currentStore:{},adsCollapsed:!1},g.youtech=d,g.search={site:"",item:""},g.facebookReady=!1,g.currentYear=(new Date).getFullYear(),g.facebookData={},g.hasJustLoggedIn=!1,g.loggedInWithFacebook=!1,g.ChainName=i.getChainName(),g.isLoggedIn=i.isLoggedIn(),g.reload=i.reload,g.broadcastEvent=c.$broadcast,g.goUrl=i.goUrl,g.encodeURIComponent=encodeURIComponent,g.isOnList=s.isOnList,g.getShoppingListCount=s.getShoppingListCount,g.$win=t,g._tk=t._tk,g.validateRegistration=function(e){g.facebookData.accessToken=e.authResponse.accessToken,u.api("/me?fields=id,name,email",function(e){if(g.facebookData.user=e,e.email){if(i.isLoggedIn())return;s.loginFacebook(e.email,g.facebookData.accessToken)}})},g.doFacebookLogin=function(){u.getLoginStatus(function(e){"connected"==e.status&&e.authResponse.accessToken?g.validateRegistration(e):u.login(function(e){e.authResponse&&g.validateRegistration(e)
},{scope:i.getFacebookPermission()})})},g.doIfLoggedIn=function(e){g.isLoggedIn?e():g.gvm.loginCounter++},g.clearSelection=i.clearSelection,g.getBindableItem=i.getBindableItem,g.updateBindableItem=i.getBindableItem,g.doSiteSearch=function(){g.goUrl("/search?q="+encodeURIComponent(g.search.site))},g.doItemSearch=function(){g.goUrl("/product/search?q="+encodeURIComponent(g.search.item))},g.getPageCount=i.getPageCount,g.getFullPath=i.getFullPath,g.decodeServerUrl=i.decodeServerUrl,g.goBack=function(){"/"!=g.currentPath&&i.goBack()},g.logout=function(){s.logOut(),g.isLoggedIn=i.isLoggedIn(),g.loggedInWithFacebook&&(g.loggedInWithFacebook=!1,u.logout()),r(function(){"/"==g.currentPath?i.reload():g.goUrl("/")},500)},g.logoutWithPrompt=function(){try{g.goOutPrompt(null,"/",g.logout,!0)}catch(e){g.logout()}},g.logoutWithPromt=g.logoutWithPrompt,g.goOutPromt=g.goOutPrompt,g.doToggleCartItem=function(e,t,n){3==t.ItemTypeId&&(t.Quantity=i.isNaN(parseInt(t.SalePriceMultiple||t.PriceMultiple||1),1)),s.isOnList(t)?s.removeItem(t):(n&&(t.OldQuantity=t.Quantity,t.Quantity=n.NewQuantity),s.addItem(t),8==t.ItemTypeId&&(null===i.isNull(t.Varieties,null)&&(t.Varieties=[]),g.gvm.selectedItem=t)),c.$broadcast("gsnevent:shoppinglist-toggle-item",t)},g.$on("$routeChangeSuccess",function(){"undefined"!=typeof gmodal&&r(gmodal.hide,50)}),g.$on("$routeChangeStart",function(t,r){return g.currentPath=e.lowercase(i.isNull(n.path(),"")),g.friendlyPath=g.currentPath.replace("/","").replace(/\/+/gi,"-"),g.gvm.search=n.search(),g.gvm.menuInactive=!1,g.gvm.shoppingListActive=!1,r.requireLogin&&!g.isLoggedIn?void g.goUrl("/signin?fromUrl="+encodeURIComponent(n.url())):r.storeRequired&&i.isNull(i.getSelectedStoreId(),0)<=0?void g.goUrl("/storelocator?fromUrl="+encodeURIComponent(n.url())):(g.currentLayout=g.defaultLayout,i.isNull(r.layout,"").length>0&&(g.currentLayout=r.layout),void(g.gvm.selectedItem=null))}),g.$on("gsnevent:profile-load-success",function(e,t){t.success&&(g.hasJustLoggedIn=!1,s.getProfile().then(function(e){e.success&&(g.gvm.profile=e.response)}))}),g.$on("gsnevent:login-success",function(e,t){g.isLoggedIn=i.isLoggedIn(),l.eventTrack("SigninSuccess",{category:t.payload.grant_type,label:t.response.user_id}),g.hasJustLoggedIn=!0,g.loggedInWithFacebook="facebook"==t.payload.grant_type}),g.$on("gsnevent:login-failed",function(e,t){if("facebook"==t.payload.grant_type){if(i.isLoggedIn())return;g.goUrl("/registration/facebook"),l.eventTrack("SigninFailed",{category:t.payload.grant_type,label:i.getProfileId()})}}),g.$on("gsnevent:store-setid",function(){a.getStore().then(function(e){l.eventTrack("StoreSelected",{category:e.StoreName,label:e.StoreNumber+""}),g.gvm.currentStore=e,s.getProfile().then(function(t){t.success&&t.response.PrimaryStoreId!=e.StoreId&&s.selectStore(e.StoreId).then(function(){c.$broadcast("gsnevent:store-persisted",e)})})})}),g.$on("gsnevent:circular-loading",function(){g.gvm.noCircular=!0}),g.$on("gsnevent:circular-loaded",function(e,t){g.gvm.noCircular=!t.success}),"undefined"!=typeof u.isReady&&i.getConfig().FacebookAppId&&g.$watch(function(){return u.isReady()},function(){g.facebookReady=!0,i.isLoggedIn()||u.getLoginStatus(function(e){"connected"==e.status&&g.validateRegistration(e)})}),g.$on("gsnevent:closemodal",function(){"undefined"!=typeof gmodal&&gmodal.hide()}),g.$on("gsnevent:shoppinglistitem-updating",function(e,t,n){var r=i.getShoppingListId();if(t.ShoppingListId==r)try{var o=a.getCategories()[n.CategoryId],s="MiscItemAddUpdate";8==n.ItemTypeId?s="CircularItemAddUpdate":2==n.ItemTypeId?s="ManufacturerCouponAddUpdate":3==n.ItemTypeId?s="ProductAddUpdate":5==n.ItemTypeId?s="RecipeIngredientAddUpdate":6==n.ItemTypeId?s="OwnItemAddUpdate":10==n.ItemTypeId?s="StoreCouponAddUpdate":13==n.ItemTypeId&&(s="YoutechCouponAddUpdate"),l.eventTrack(s,{category:13==n.ItemTypeId?n.ExtCategory:o.CategoryName,label:n.Description,item:n})}catch(c){}}),g.$on("gsnevent:shoppinglistitem-removing",function(e,t,n){var r=i.getShoppingListId();if(t.ShoppingListId==r)try{var o=a.getCategories()[n.CategoryId],s=null,c=n.ItemId;8==n.ItemTypeId?l.eventTrack("CircularItemRemove",{category:o.CategoryName,label:n.Description,item:n}):2==n.ItemTypeId?(s=a.getCoupon(n.ItemId,2),s&&(n=s,i.isNull(n.ProductCode,"").length>0&&(c=n.ProductCode)),l.eventTrack("ManufacturerCouponRemove",{category:o.CategoryName,label:n.Description,item:n})):3==n.ItemTypeId?l.eventTrack("ProductRemove",{category:o.CategoryName,label:n.Description,item:n}):5==n.ItemTypeId?l.eventTrack("RecipeIngredientRemove",{category:o.CategoryName,label:n.Description,item:n}):6==n.ItemTypeId?l.eventTrack("OwnItemRemove",{label:n.Description}):10==n.ItemTypeId?(s=a.getCoupon(n.ItemId,10),s&&(n=s,i.isNull(n.ProductCode,"").length>0&&(c=n.ProductCode)),l.eventTrack("StoreCouponRemove",{category:o.CategoryName,label:n.Description,item:n})):13==n.ItemTypeId?(s=a.getCoupon(n.ItemId,13),s&&(n=s,i.isNull(n.ProductCode,"").length>0&&(c=n.ProductCode)),l.eventTrack("YoutechCouponRemove",{category:n.ExtCategory,label:n.Description,item:n})):l.eventTrack("MiscItemRemove",{category:o.CategoryName,label:n.Description,item:n})}catch(u){}}),g.$on("gsnevent:gsnmodal-hide",f),void g.$on("gsnevent:gsnmodal-show",f))}var p={init:g,hasInit:!1};return p}var n="gsnGlobal";e.module("gsn.core").service(n,["$window","$location","$timeout","$route","gsnApi","gsnProfile","gsnStore","$rootScope","Facebook","$analytics","gsnYoutech","gsnDfp","gsnAdvertising",t])}(angular),function(e,t){"use strict";function n(n,r,o,i,s){function a(s,a){function u(e,t){if(e){{p.getItemKey(t)}e.Order=t.Order,e.ItemId!=t.ItemId&&p.removeItem(t,!0),f.items[p.getItemKey(e)]=e,l()}}function l(){c.currentShoppingList=f,f.countCache=0}function d(){var t=c.currentShoppingList;if(t&&t.list&&t.list.Id==s){var n=!0;e.forEach(t.items,function(e){o.isNull(e)&&(n=!1)}),n?(f.hasLoaded=t.hasLoaded,f.items=t.items,f.itemIdentity=t.itemIdentity,f.countCache=t.countCache):(f.hasLoaded=!1,p.updateShoppingList())}}function g(t){f.items={},e.forEach(t,function(e,t){e.Order=t,f.items[p.getItemKey(e)]=e}),f.hasLoaded=!0,f.itemIdentity=t.length+1,n.$broadcast("gsnevent:shoppinglist-loaded",p,t),l()}var p={ShoppingListId:s},f={list:a,items:{},hasLoaded:!1,countCache:0,itemIdentity:1};return p.getItemKey=function(e){var t=e.ItemTypeId;return(7==e.ItemTypeId||e.AdCode)&&(t=e.AdCode+o.isNull(e.BrandName,"")+o.isNull(e.Description,"")),t+"_"+e.ItemId},p.syncItem=function(i){var s=p.getItem(i.ItemId,i.ItemTypeId)||i;if(s!=i&&(s.Quantity=i.Quantity),parseInt(s.Quantity)>0){var a=e.copy(s);a.BarcodeImageUrl=t,a.BottomTagLine=t,a.Description1=t,a.Description2=t,a.Description3=t,a.Description4=t,a.EndDate=t,a.ImageUrl=t,a.SmallImageUrl=t,a.StartDate=t,a.TopTagLine=t,a.TotalDownloads=t,a.TotalDownloadsAllowed=t,a.Varieties=t,a.PageNumber=t,a.rect=null,n.$broadcast("gsnevent:shoppinglistitem-updating",p,s,f),o.getAccessToken().then(function(){var e=o.getShoppingListApiUrl()+"/UpdateItem/"+p.ShoppingListId,t=o.getApiHeaders();t.shopping_list_id=p.ShoppingListId,r.post(e,a,{headers:t}).success(function(e){e.Id&&u(e,s),n.$broadcast("gsnevent:shoppinglist-changed",p),l()}).error(function(){s.OldQuantity&&(s.NewQuantity=s.OldQuantity,s.Quantity=s.OldQuantity,l())})})}else p.removeItem(s);l(),n.$broadcast("gsnevent:shoppinglist-changed",p)},p.addItem=function(e,n){o.isNull(e.ItemId,0)<=0&&(e.ItemId=f.itemIdentity++),f.countCache=0;var r=f.items[p.getItemKey(e)];if(null===gsn.isNull(r,null))e.Id=t,e.ShoppingListItemId=t,e.ShoppingListId=p.ShoppingListId,e.CategoryId=e.CategoryId||-1,r=e,f.items[p.getItemKey(r)]=r;else{var i=o.isNaN(parseInt(e.Quantity),1),s=o.isNaN(parseInt(r.Quantity),1);r.Quantity=i>s?i:s+i}if(r.IsCoupon){var a=o.isNaN(parseInt(r.Quantity),0);r.Quantity=a>0?a:1}return r.Order=f.itemIdentity++,o.isNull(n,!1)?l():p.syncItem(r),r},p.addItems=function(t){var s=i.defer(),a=[];return e.forEach(t,function(t){var n=e.copy(p.addItem(t,!0));a.push(n)}),n.$broadcast("gsnevent:shoppinglistitems-updating",p),l(),o.getAccessToken().then(function(){var e=o.getShoppingListApiUrl()+"/SaveItems/"+p.ShoppingListId,t=o.getApiHeaders();t.shopping_list_id=p.ShoppingListId,r.post(e,a,{headers:t}).success(function(e){n.$broadcast("gsnevent:shoppinglist-changed",p),s.resolve({success:!0,response:e}),l()}).error(function(){s.resolve({success:!1,response:response})})}),s.promise},p.removeItem=function(t,i){var s=p.getItem(t);if(s){s.Quantity=0;var a=p.getItemKey(s);try{delete f.items[a]}catch(c){var u={};e.forEach(f.items,function(e,t){t!=a&&(u[t]=e)}),f.items=u}if(l(),i)return p;o.getAccessToken().then(function(){n.$broadcast("gsnevent:shoppinglistitem-removing",p,s);var e=o.getShoppingListApiUrl()+"/DeleteItems/"+p.ShoppingListId,t=o.getApiHeaders();t.shopping_list_id=p.ShoppingListId,r.post(e,[s.Id||s.ItemId],{headers:t}).success(function(){n.$broadcast("gsnevent:shoppinglist-changed",p),l()})})}return p},p.getItem=function(e,t){var n,r,i;"object"==typeof e&&(n=e.AdCode,r=e.BrandName,i=e.Description,t=e.ItemTypeId,e=e.ItemId);var s=p.getItemKey({ItemId:e,ItemTypeId:o.isNull(t,8),AdCode:n,BrandName:r,Description:i});return f.items[s]},p.isValidItem=function(e){var t=typeof e;return"undefined"!==t&&"function"!==t?e.Quantity>0:!1},p.allItems=function(){var t=[],n=f.items;return e.forEach(n,function(e){p.isValidItem(e)&&t.push(e)}),t},p.getCount=function(){if(f.countCache>0)return f.countCache;var t=0,n=f.items,r=!0;return e.forEach(n,function(e){return e?void(p.isValidItem(e)&&(t+=o.isNaN(parseInt(e.Quantity),0))):void(r=!1)}),r||(f.items={},f.hasLoaded=!1,p.updateShoppingList()),f.countCache=t,t},p.clearItems=function(){f.items={},p.saveChanges()},p.getTitle=function(){return f.list?f.list.Title:""},p.getStatus=function(){return f.list?f.list.StatusId:1},p.deleteList=function(){return f.countCache=0,o.getAccessToken().then(function(){var e=o.getShoppingListApiUrl()+"/Delete/"+p.ShoppingListId,t=o.getApiHeaders();t.shopping_list_id=p.ShoppingListId,r.post(e,{},{headers:t}).success(function(){n.$broadcast("gsnevent:shoppinglist-deleted",p),l()})}),p},p.saveChanges=function(){if(p.savingDeferred)return p.savingDeferred.promise;var t=i.defer();p.savingDeferred=t,f.countCache=0;var s=[],a=p.allItems();return e.forEach(a,function(e){s.push(e.ItemId)}),l(),o.getAccessToken().then(function(){var e=o.getShoppingListApiUrl()+"/DeleteOtherItems/"+p.ShoppingListId,i=o.getApiHeaders();i.shopping_list_id=p.ShoppingListId,r.post(e,s,{headers:i}).success(function(){t.resolve({success:!0,response:p}),p.savingDeferred=null,n.$broadcast("gsnevent:shoppinglist-changed",p),l()}).error(function(e){t.resolve({success:!1,response:e}),p.savingDeferred=null})}),t.promise},p.setTitle=function(e){var t=i.defer();return f.countCache=0,o.getAccessToken().then(function(){var i=o.getShoppingListApiUrl()+"/Update/"+p.ShoppingListId+"?title="+encodeURIComponent(e),s=o.getApiHeaders();s.shopping_list_id=p.ShoppingListId,r.post(i,{},{headers:s}).success(function(){t.resolve({success:!0,response:p}),f.list.Title=e,n.$broadcast("gsnevent:shopping-list-saved"),n.$broadcast("gsnevent:shoppinglist-changed",p),l()}).error(function(e){console.log(p.ShoppingListId+" setTitle error: "+e),t.resolve({success:!1,response:e})})}),t.promise},p.hasLoaded=function(){return f.hasLoaded},p.getListData=function(){return e.copy(f.list)},p.updateShoppingList=function(){if(p.deferred)return p.deferred.promise;var e=i.defer();return p.deferred=e,p.ShoppingListId>0&&(f.hasLoaded?(n.$broadcast("gsnevent:shoppinglist-loaded",p,f.items),e.resolve({success:!0,response:p}),p.deferred=null):(f.items={},f.countCache=0,o.getAccessToken().then(function(){var t=o.getShoppingListApiUrl()+"/ItemsBy/"+p.ShoppingListId+"?nocache="+(new Date).getTime(),i=o.getApiHeaders();i.shopping_list_id=p.ShoppingListId,r.get(t,{headers:i}).success(function(t){g(t),n.$broadcast("gsnevent:shoppinglist-loaded",p,f.items),e.resolve({success:!0,response:p}),p.deferred=null}).error(function(t){n.$broadcast("gsnevent:shoppinglist-loadfail",t),e.resolve({success:!1,response:t}),p.deferred=null})}))),e.promise},d(),p}var c=s;return a}var r="gsnList";e.module("gsn.core").factory(r,["$rootScope","$http","gsnApi","$q","$sessionStorage",n])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.service("$notification",["$rootScope","$window",function(e,t){var n={alert:function(e){return t.isPhoneGap?void navigator.notification.alert(e,null,"","OK"):void gmodal.show({content:'<div class="myModalForm" style="display: block"><div class="modal-dialog"><div class="modal-content"><div class="modal-body">'+e+'<br /><br/><button class="btn btn-default gmodal-close pull-right" style="width: 80px" data-ng-click="closeModal()">OK</button><br /></div></div></div></div>',hideOn:"click,esc,tap"})},confirm:function(e,n,r,o){return null===gsn.isNull(o,null)&&(o="OK,Cancel"),t.isPhoneGap?void navigator.notification.confirm(e,n,r,o.split(",")):void n(t.confirm(e)?1:2)},prompt:function(e,n,r,o,i){if(null===gsn.isNull(i,null)&&(i="OK,Cancel"),null===gsn.isNull(o,null)&&(o=""),!t.isPhoneGap){var s=t.prompt(e,o);return void n({buttonIndex:s?1:2,input1:s})}navigator.notification.prompt(e,n,r,i.split(","),o)}};return n}]),t.factory("debounce",["$timeout",function(){return function(e,t,n){var r;return function(){var o=this,i=arguments,s=function(){r=null,n||e.apply(o,i)},a=n&&!r;clearTimeout(r),r=setTimeout(s,t),a&&e.apply(o,i)}}}]),t.factory("FeedService",["$http","gsnApi",function(e,t){return{parseFeed:function(n,r){return e.jsonp("//ajax.googleapis.com/ajax/services/feed/load?v=1.0&num="+t.isNull(r,50)+"&callback=JSON_CALLBACK&q="+encodeURIComponent(n))}}}]),t.factory("gsnAuthenticationHandler",["$rootScope","$q",function(e,t){var n={responseError:function(n){return 401==n.status?e.$broadcast("gsnevent:auth-expired",arguments):400==n.status&&n.data&&"string"==typeof n.data&&(n.data.indexOf("refresh_token is invalid or has expired")>-1||n.data.indexOf("Illegal attempt to refresh an anonymous token for user that is no longer anonymous.")>-1)&&e.$broadcast("gsnevent:auth-invalidrefresh",arguments),t.reject(n)}};return n}]),t.directive("bsDisplayMode",["$window","$timeout",function(t,n){return{template:'<div class="visible-xs"></div><div class="visible-sm"></div><div class="visible-md"></div><div class="visible-lg"></div>',restrict:"EA",replace:!1,link:function(r,o,i){function s(){e.forEach(a,function(t){e.element(t).is(":visible")&&(r[i.bsDisplayMode]=t.className)})}var a=o.find("div");e.element(t).bind("resize",function(){n(s,300)}),s()}}}]),t.directive("scrollTo",["$location",function(e){return function(t,n,r){n.bind("click",function(n){n.stopPropagation();var o=t.$on("$locationChangeStart",function(e){o(),e.preventDefault()}),i=r.scrollTo;e.hash(i)})}}]),t.directive("ngScrollTop",["$window","$timeout","debounce",function(t,n,r){function o(n,o,i){s++;var a=r(function(){n.scrollTop=e.element(t).scrollTop(),o.css({display:n.scrollTop>parseInt(i.offset)&&1==s?"block":""})},300);e.element(t).on("scroll",a),o.on("click",function(){e.element(t).scrollTop(0)}),n.$on("$destroy",function(){s--})}var i={link:o,restrict:"A"},s=0;return i}]),t.directive("stopEvent",function(){return{restrict:"A",link:function(e,t,n){t.bind(n.stopEvent,function(e){e.stopPropagation()})}}})}(angular),function(e){"use strict";function t(t,r,o,i,s,a,c,u,l,d,g){function p(){var e=o.getProfileApiUrl()+"/By/"+h.getProfileId();r.get(e,{headers:o.getApiHeaders()}).success(function(e){S.profile=e,t.$broadcast("gsnevent:profile-load-success",{success:!0,response:S.profile}),y.resolve({success:!0,response:S.profile}),y=null}).error(function(e){t.$broadcast("gsnevent:profile-load-failed",{success:!1,response:e}),y.resolve({success:!1,response:e}),y=null})}function f(e,t){var n=i.defer(),s=o.isNull(e.Email,"").replace(/\s+/gi,""),a=o.isNull(e.UserName,"").replace(/\s+/gi,"");a.length<=0&&(a=s),s.length<=0&&(s=null),a.length<=0&&(a=null);var c={Email:s,UserName:a,Password:o.isNull(e.Password,""),ReceiveEmail:o.isNull(e.ReceiveEmail,!1),ReceiveSms:o.isNull(e.ReceiveSms,!0),Phone:o.isNull(e.Phone,"").replace(/[^0-9]+/gi,""),PrimaryStoreId:o.isNull(e.PrimaryStoreId,o.getSelectedStoreId()),FirstName:o.isNull(e.FirstName,"").replace(/[`]+/gi,"'"),LastName:o.isNull(e.LastName,"").replace(/[`]+/gi,"'"),ExternalId:e.ExternalId,WelcomeSubject:e.WelcomeSubject,WelcomeMessage:e.WelcomeMessage,FacebookUserId:e.FacebookUserId,SiteId:o.getChainId(),Id:o.getProfileId()};return""===c.Password&&(c.Password=null),""===c.LastName&&(c.LastName=null),""===c.FirstName&&(c.FirstName=null),o.isNull(c.PrimaryStoreId,0)<=0&&(c.PrimaryStoreId=null),o.isNull(e.ExternalId,"").length<=0&&(e.ExternalId=null),o.isNull(e.FacebookUserId,"").length<=0&&(e.FacebookUserId=null),c.UserName.length<3?(n.resolve({success:!1,response:"Email/UserName must be at least 3 characters."}),n.promise):!t&&o.isNull(e.FacebookToken,"").length<=0&&o.isNull(c.Password,"").length<6?(n.resolve({success:!1,response:"Password must be at least 6 characters."}),n.promise):o.getEmailRegEx().test(c.Email)?(o.getAccessToken().then(function(){var i=o.getProfileApiUrl()+(t?"/Update":"/Register");o.isNull(e.FacebookToken,"").length>1&&(i+="Facebook",c.Password=e.FacebookToken),r.post(i,c,{headers:o.getApiHeaders()}).success(function(e){S.profile=e,n.resolve({success:!0,response:e})}).error(function(e){n.resolve({success:!1,response:e})})}),n.promise):(n.resolve({success:!1,response:"Email is invalid."}),n.promise)}var h={},m=o.getProfileId(),v=l,y=null,I=null,S={allShoppingLists:{},profile:null,profileData:{scoredProducts:{},circularItems:{},availableCoupons:{},myPantry:{}}};return t[n]=h,o.gsn.$profile=h,h.getShoppingListId=o.getShoppingListId,h.getProfileId=o.getProfileId,h.createNewShoppingList=function(){return I?I.promise:(I=i.defer(),o.getAccessToken().then(function(){var e=o.getShoppingListApiUrl()+"/Create/"+o.getProfileId();r.post(e,{},{headers:o.getApiHeaders()}).success(function(e){var n=e;S.allShoppingLists[n.Id]=s(n.Id,n),o.setShoppingListId(n.Id),t.$broadcast("gsnevent:shoppinglist-created",S.allShoppingLists[n.Id]),I.resolve({success:!0,response:S.allShoppingLists[n.Id]}),I=null}).error(function(e){I.resolve({success:!1,response:e}),I=null})}),I.promise)},h.login=function(e,t){var n={grant_type:"password",client_id:o.getChainId(),access_type:"offline",username:e,password:t};o.doAuthenticate(n)},h.loginFacebook=function(e,t){var n={grant_type:"facebook",client_id:o.getChainId(),access_type:"offline",username:e,password:t};o.doAuthenticate(n)},h.initialize=function(){var e=parseInt(o.isNull(h.getProfileId(),0));e>0&&h.getProfile(!0),a.initialize()},h.logOut=function(){o.logOut(),v.clipped=[],v.printed=[],v.preClipped={}},h.addItem=function(e){var t=h.getShoppingList();t&&(o.isNull(e.ItemTypeId,0)<=0&&(e.ItemTypeId=6),t.addItem(e),gsn.emit("AddItem",e))},h.addItems=function(e){var t=h.getShoppingList();return t.addItems(e)},h.isOnList=function(e){var t=h.getShoppingList();if(t){var n=t.getItem(e.ItemId,e.ItemTypeId);return null!==o.isNull(n,null)}return!1},h.removeItem=function(e){var t=h.getShoppingList();t&&(t.removeItem(e),gsn.emit("RemoveItem",e))},h.deleteShoppingList=function(e){e.deleteList(),S.allShoppingLists[e.ShoppingListId]=null},h.getShoppingList=function(e){null===o.isNull(e,null)&&(e=h.getShoppingListId());var t=S.allShoppingLists[e];return t},h.getShoppingLists=function(){var t=[];return e.forEach(S.allShoppingLists,function(e){t.push(e)}),o.sortOn(t,"ShoppingListId"),t.reverse(),t},h.getShoppingListCount=function(){var e=h.getShoppingList();return e?e.getCount():0},h.getProfile=function(e){return y?y.promise:(y=i.defer(),null===o.isNull(S.profile,null)||e?(u(function(){S={allShoppingLists:{},profile:null,profileData:{scoredProducts:{},circularItems:{},availableCoupons:{},myPantry:{}}},h.refreshShoppingLists()},5),o.getAccessToken().then(function(){o.isAnonymous()?(S.profile={Id:h.getProfileId(),SiteId:o.getChainId(),PrimaryStoreId:o.getSelectedStoreId()},t.$broadcast("gsnevent:profile-load-success",{success:!0,response:S.profile}),y.resolve({success:!0,response:S.profile}),y=null):o.getConfig().hasRoundyProfile?g.getProfile().then(function(e){e.success?(S.profile=e.response,t.$broadcast("gsnevent:profile-load-success",{success:!0,response:S.profile}),y.resolve(e),y=null):p()}):p()})):u(function(){y.resolve({success:!0,response:S.profile}),y=null},10),y.promise)},h.registerProfile=function(e){return f(e,!1)},h.changePassword=function(e,t,n){var s=i.defer();return o.getAccessToken().then(function(){var i=o.getProfileApiUrl()+"/ChangePassword";r.post(i,{UserName:e,Password:t,NewPassword:n},{headers:o.getApiHeaders()}).success(function(e){s.resolve({success:"true"==e,response:e})}).error(function(e){s.resolve({success:!1,response:e})})}),s.promise},h.recoverPassword=function(e){var t=i.defer();return o.getAccessToken().then(function(){var n=o.getProfileApiUrl()+"/RecoverPassword";r.post(n,e,{headers:o.getApiHeaders()}).success(function(e){t.resolve({success:"true"==e,response:e})}).error(function(e){t.resolve({success:!1,response:e})})}),t.promise},h.recoverUsername=function(e){var t=i.defer();return o.getAccessToken().then(function(){var n=o.getProfileApiUrl()+"/RecoverUsername";r.post(n,e,{headers:o.getApiHeaders()}).success(function(e){t.resolve({success:"true"==e,response:e})}).error(function(e){t.resolve({success:!1,response:e})})}),t.promise},h.unsubscribeEmail=function(e){var t=i.defer();return o.getAccessToken().then(function(){var n=o.getProfileApiUrl()+"/Unsubscribe/?email="+encodeURIComponent(e);r.post(n,{email:e},{headers:o.getApiHeaders()}).success(function(e){t.resolve({success:!0,response:e})}).error(function(e){t.resolve({success:!1,response:e})})}),t.promise},h.updateProfile=function(e){return f(e,!0)},h.refreshShoppingLists=function(){if(h.refreshingDeferred)return h.refreshingDeferred.promise;var e=i.defer();return h.refreshingDeferred=e,S.allShoppingLists={},o.getAccessToken().then(function(){var n=o.getShoppingListApiUrl()+"/List/"+o.getProfileId();r.get(n,{headers:o.getApiHeaders()}).success(function(n){if(n.length>0)for(var r=0;r<n.length;r++){var i=n[r];i.ShoppingListId=i.Id;var a=s(i.ShoppingListId,i);S.allShoppingLists[i.ShoppingListId]=a,0===r&&(a.updateShoppingList(),o.setShoppingListId(i.ShoppingListId))}else h.createNewShoppingList();h.refreshingDeferred=null,t.$broadcast("gsnevent:shoppinglists-loaded",{success:!0,response:n}),e.resolve({success:!0,response:n})}).error(function(t){h.refreshingDeferred=null,e.resolve({success:!1,response:t})})}),e.promise},h.getMyCircularItems=function(){var e=o.getProfileApiUrl()+"/GetCircularItems/"+o.getProfileId();return o.http(S.profileData.circularItems,e)},h.getMyPantry=function(e,t){var n=o.getProfileApiUrl()+"/GetPantry/"+o.getProfileId()+"?departmentId="+o.isNull(e,"")+"&categoryId="+o.isNull(t,"");return o.http(S.profileData.myPantry,n)},h.getMyProducts=function(){var e=o.getProfileApiUrl()+"/GetScoredProducts/"+o.getProfileId();return o.http(S.profileData.scoredProducts,e)},h.getMyRecipes=function(){var e=o.getProfileApiUrl()+"/GetSavedRecipes/"+o.getProfileId();return o.http({},e)},h.rateRecipe=function(e,t){var n=o.getProfileApiUrl()+"/RateRecipe/"+e+"/"+o.getProfileId()+"/"+t;return o.http({},n,{})},h.getMyRecipe=function(e){var t=o.getProfileApiUrl()+"/GetSavedRecipe/"+o.getProfileId()+"/"+e;return o.http({},t)},h.saveRecipe=function(e,t){var n=o.getProfileApiUrl()+"/SaveRecipe/"+e+"/"+o.getProfileId()+"?comment="+encodeURIComponent(t);return o.http({},n,{})},h.saveProduct=function(e,t){var n=o.getProfileApiUrl()+"/SaveProduct/"+e+"/"+o.getProfileId()+"?comment="+encodeURIComponent(t);return o.http({},n,{})},h.selectStore=function(e){var t=o.getProfileApiUrl()+"/SelectStore/"+o.getProfileId()+"/"+e;return o.http({},t,{})},h.getCampaign=function(){var e=o.getProfileApiUrl()+"/GetCampaign/"+o.getProfileId();return o.http({},e)},h.resetCampaign=function(){l.GsnCampaign=0},h.sendContactUs=function(e){var t=i.defer();return o.getAccessToken().then(function(){var n=o.getProfileApiUrl()+"/SendContactUs";r.post(n,e,{headers:o.getApiHeaders()}).success(function(e){t.resolve({success:!0,response:e})}).error(function(e){t.resolve({success:!1,response:e})})}),t.promise},h.sendEmail=function(e){var t=i.defer();return o.getAccessToken().then(function(){var n=o.getProfileApiUrl()+"/SendEmail";r.post(n,e,{headers:o.getApiHeaders()}).success(function(e){t.resolve({success:!0,response:e})}).error(function(e){t.resolve({success:!1,response:e})})}),t.promise},h.sendEmploymentEmail=function(e,t){var n=i.defer();return o.getAccessToken().then(function(){var i=o.getProfileApiUrl()+"/SendEmployment/"+t;r.post(i,e,{headers:o.getApiHeaders()}).success(function(e){n.resolve({success:!0,response:e})}).error(function(e){n.resolve({success:!1,response:e})})}),n.promise},h.clipCoupon=function(e){v.clipped||(v.clipped=[]),v.clipped.indexOf(e)<0&&v.clipped.push(e)},h.unclipCoupon=function(e){var t=v.clipped.indexOf(e);v.clipped.splice(t,1)},h.getClippedCoupons=function(){return v.clipped},h.savePreclippedCoupon=function(e){v.preClipped=e},h.getPreclippedCoupon=function(){return v.preClipped},h.addPrinted=function(e){v.printed||(v.printed=[]),v.printed.indexOf(e)<0&&v.printed.push(e)},h.getPrintedCoupons=function(){return v.printed},t.$on("gsnevent:shoppinglist-item-response",function(e,t){var n=t[1],r=t[2],i=t[3];o.isLoggedIn()&&(r.ItemId!=n.ItemId&&(i.items[r.ItemId]=null,r.ItemId=n.ItemId),r.zPriceMultiple&&(n.PriceMultiple=r.zPriceMultiple),n.Order=r.Order,i.items[r.ItemId]=n.d)}),t.$on("gsnevent:profile-setid",function(e,t){m!=t&&(m=t,h.getProfile(!0),h.resetCampaign())}),t.$on("gsnevent:profile-load-success",function(e,t){o.isNull(t.response.PrimaryStoreId,0)>0&&o.setSelectedStoreId(t.response.PrimaryStoreId)}),t.$on("gsnevent:store-setid",function(e,t){if(t.newValue!=t.oldValue){var n=h.getShoppingList();n&&n.updateShoppingList()}}),h}var n="gsnProfile";e.module("gsn.core").service(n,["$rootScope","$http","gsnApi","$q","gsnList","gsnStore","$location","$timeout","$sessionStorage","$localStorage","gsnRoundyProfile",t])}(angular),function(e){"use strict";function t(e,t,n,r,o,i){function s(){c.profile={Email:null,PrimaryStoreId:null,FirstName:null,LastName:null,Phone:null,AddressLine1:null,AddressLine2:null,City:null,State:null,PostalCode:null,FreshPerksCard:null,ReceiveEmail:!1,Id:null,IsECard:!1}}function a(e,t){t.resolve({success:!1,response:e}),r.$broadcast("gsnevent:roundy-error",{success:!1,response:e})}var c={};return c.profile={},c.getProfileDefer=null,s(),c.saveProfile=function(o){var s=n.defer();return e.getAccessToken().then(function(){var n=e.getRoundyProfileUrl()+"/SaveProfile/"+e.getChainId();o.PostalCode&&(o.PostalCode=o.PostalCode.substr(0,5)),t.post(n,o,{headers:e.getApiHeaders()}).success(function(e){s.resolve({success:!0,response:e}),r.$broadcast("gsnevent:updateprofile-successful",e),i.eventTrack("profile-update",{category:"profile",label:e.ReceiveEmail})}).error(function(e){a(e,s)})}),s.promise},c.validateLoyaltyCard=function(r){var o=n.defer();return e.getAccessToken().then(function(){var n=e.getRoundyProfileUrl()+"/ValidateLoyaltyCard/"+e.getChainId()+"/"+e.getProfileId()+"?loyaltyCardNumber="+r;t.get(n,{headers:e.getApiHeaders()}).success(function(e){o.resolve({success:!0,response:e})}).error(function(e){a(e,o)})}),o.promise},c.removeLoyaltyCard=function(){var r=n.defer();return e.getAccessToken().then(function(){var n=e.getRoundyProfileUrl()+"/RemoveLoyaltyCard/"+e.getChainId()+"/"+e.getProfileId();t.get(n,{headers:e.getApiHeaders()}).success(function(e){r.resolve({success:!0,response:e})}).error(function(e){a(e,r)})}),r.promise},c.getProfile=function(r){var i;return c.profile.FirstName&&!r?(i=n.defer(),o(function(){i.resolve({success:!0,response:c.profile})},500)):c.getProfileDefer?i=c.getProfileDefer:(c.getProfileDefer=n.defer(),i=c.getProfileDefer,e.getAccessToken().then(function(){var n=e.getRoundyProfileUrl()+"/GetProfile/"+e.getChainId()+"/"+e.getProfileId();t.get(n,{headers:e.getApiHeaders()}).success(function(e){if(c.profile=e,e.ExternalId&&(c.profile.FreshPerksCard=e.ExternalId),e.PostalCode)for(;c.profile.PostalCode.length<5;)c.profile.PostalCode+="0";i.resolve({success:!0,response:e}),c.getProfileDefer=null}).error(function(e){a(e,i)})})),i.promise},c.mergeAccounts=function(r,o){var i=n.defer();return e.getAccessToken().then(function(){var n=e.getRoundyProfileUrl()+"/MergeAccounts/"+e.getChainId()+"/"+e.getProfileId()+"?newCardNumber="+r+"&updateProfile="+o;t.post(n,{},{headers:e.getApiHeaders()}).success(function(e){i.resolve({success:!0,response:e})}).error(function(e){a(e,i)})}),i.promise},c.removePhone=function(){var r=n.defer();return e.getAccessToken().then(function(){var n=e.getRoundyProfileUrl()+"/SavePhoneNumber/"+e.getChainId()+"/"+e.getProfileId()+"?phoneNumber=";t.post(n,{},{headers:e.getApiHeaders()}).success(function(e){c.profile.Phone=null,r.resolve({success:!0,response:e})}).error(function(e){a(e,r)})}),r.promise},c.savePhonNumber=function(r){var o=n.defer();return e.getAccessToken().then(function(){var n=e.getRoundyProfileUrl()+"/SavePhoneNumber/"+e.getChainId()+"/"+e.getProfileId()+"?phoneNumber="+r;t.post(n,{},{headers:e.getApiHeaders()}).success(function(e){o.resolve({success:!0,response:e})}).error(function(e){a(e,o)})}),o.promise},c.isValidPhone=function(r){var o=n.defer();return e.getAccessToken().then(function(){var n=e.getRoundyProfileUrl()+"/IsValidPhone/"+e.getChainId()+"/"+c.profile.FreshPerksCard+"?phone="+r;t.get(n,{headers:e.getApiHeaders()}).success(function(e){o.resolve({success:!0,response:e})}).error(function(e){a(e,o)})}),o.promise},c.profileByCardNumber=function(r){var o=n.defer();return e.getAccessToken().then(function(){var n=e.getRoundyProfileUrl()+"/ProfileBy/"+e.getChainId()+"/"+r;t.get(n,{headers:e.getApiHeaders()}).success(function(e){"object"==typeof e&&e.FirstName?o.resolve({success:!0,response:e}):a(e,o)}).error(function(e){a(e,o)})}),o.promise},c.registerLoyaltyCard=function(r){var o=n.defer();return e.getAccessToken().then(function(){var n=e.getRoundyProfileUrl()+"/RegisterLoyaltyCard/"+e.getChainId()+"/"+e.getProfileId();r.PostalCode&&(r.PostalCode=r.PostalCode.substr(0,5)),t.post(n,r,{headers:e.getApiHeaders()}).success(function(e){o.resolve({success:!0,response:e})}).error(function(e){a(e,o)})}),o.promise},c.registerELoyaltyCard=function(r){var o=n.defer();return e.getAccessToken().then(function(){var n=e.getRoundyProfileUrl()+"/RegisterELoyaltyCard/"+e.getChainId()+"/"+e.getProfileId();r.PostalCode&&(r.PostalCode=r.PostalCode.substr(0,5)),t.post(n,r,{headers:e.getApiHeaders()}).success(function(e){o.resolve({success:!0,response:e})}).error(function(e){a(e,o)})}),o.promise},c.associateLoyaltyCardToProfile=function(r){var o=n.defer();return e.getAccessToken().then(function(){var n=e.getRoundyProfileUrl()+"/AssociateLoyaltyCardToProfile/"+e.getChainId()+"/"+e.getProfileId()+"?loyaltyCardNumber="+r;t.get(n,{headers:e.getApiHeaders()}).success(function(e){o.resolve({success:!0,response:e})}).error(function(e){a(e,o)})}),o.promise},c.addOffer=function(r){var o=n.defer();return e.getAccessToken().then(function(){var n=e.getRoundyProfileUrl()+"/AddOffer/"+e.getProfileId()+"/"+r;t.post(n,{},{headers:e.getApiHeaders()}).success(function(e){o.resolve({success:!0,response:e})}).error(function(e){a(e,o)})}),o.promise},r.$on("gsnevent:logout",function(){s()}),c}var n="gsnRoundyProfile";e.module("gsn.core").service(n,["gsnApi","$http","$q","$rootScope","$timeout","$analytics",t])}(angular),function(e){"use strict";function t(t){return["$rootScope","$window","$log",function(o,i,s){function a(e){var t=i[e];if(t&&"localStorage"===e){var n="__"+Math.round(1e7*Math.random());try{localStorage.setItem(n,n),localStorage.removeItem(n)}catch(r){t=!1}}return t}for(var c,u,l,d=a(t)||(s.warn("This browser does not support Web Storage!"),r),g={$default:function(t){for(var n in t)e.isDefined(g[n])||(g[n]=t[n]);return g},$reset:function(e){for(var t in g)"$"===t[0]||delete g[t];
return g.$default(e)}},p=0;p<d.length;p++)(l=d.key(p))&&n===l.slice(0,n.length)&&(g[l.slice(n.length)]=e.fromJson(d.getItem(l)));return c=e.copy(g),o.$watch(function(){u||(u=setTimeout(function(){if(u=null,!e.equals(g,c)){e.forEach(g,function(t,r){e.isDefined(t)&&"$"!==r[0]&&d.setItem(n+r,e.toJson(t)),delete c[r]});for(var t in c)d.removeItem(n+t);c=e.copy(g)}},100))}),"localStorage"===t&&i.addEventListener&&i.addEventListener("storage",function(t){if(n===t.key.slice(0,n.length)){if("undefined"==typeof t.newValue)return;t.newValue?g[t.key.slice(n.length)]=e.fromJson(t.newValue):delete g[t.key.slice(n.length)],c=e.copy(g),o.$apply()}}),g}]}var n="gsnStorage-",r={};e.module("gsn.core").factory("$localStorage",t("localStorage")).factory("$sessionStorage",t("sessionStorage"))}(angular),function(e){"use strict";function t(t,r,o,i,s,a){function c(t,n){if(n){var r=t;"string"!=typeof r&&(e.forEach(r,function(e){e.Settings=o.mapObject(e.StoreSettings,"StoreSettingId")}),I.storeList=r)}var i=a.search(),s=i.sfs||i.selectFirstStore||i.selectfirststore;if(t=o.isNull(t,[]),1==t.length||s)t[0].StoreId!=o.isNull(o.getSelectedStoreId(),0)&&o.setSelectedStoreId(t[0].StoreId);else if(i.storeid){var c=o.mapObject(t,"StoreId");o.setSelectedStoreId(c[i.storeid].StoreId)}else if(i.storenbr){var u=o.mapObject(t,"StoreNumber");o.setSelectedStoreId(u[i.storenbr].StoreId)}else if(i.store){{o.mapObject(t,"StoreUrl")}u[i.store]&&o.setSelectedStoreId(u[i.store].StoreId)}}function u(){if(!(o.isNull(y.manufacturerCoupons.items,[]).length>0)){var t=v.getCircularData();y.manufacturerCoupons.items=t.ManufacturerCoupons,e.forEach(y.manufacturerCoupons.items,function(e){e.CategoryName=o.isNull(S.categoryById[e.CategoryId],{CategoryName:""}).CategoryName,S.manuCouponById[e.ItemId]=e}),o.getConfig().hasPrintableCoupon=y.manufacturerCoupons.items.length>0}}function l(){var t=v.getCircularData(),n=[];e.forEach(t.InstoreCoupons,function(e){(e.StoreIds.length<=0||e.StoreIds.indexOf(y.storeId)>=0)&&(e.CategoryName=o.isNull(S.categoryById[e.CategoryId],{CategoryName:""}).CategoryName,S.storeCouponById[e.ItemId]=e,n.push(e))}),o.getConfig().hasStoreCoupon=n.length>0,y.instoreCoupons.items=n}function d(){if(!(o.isNull(y.youtechCoupons.items,[]).length>0)){var t=v.getCircularData();y.youtechCoupons.items=t.YoutechCoupons,e.forEach(y.youtechCoupons.items,function(e){e.CategoryName=o.isNull(S.categoryById[e.CategoryId],{CategoryName:""}).CategoryName,S.youtechCouponById[e.ItemId]=e}),o.getConfig().hasDigitalCoupon=y.youtechCoupons.items.length>0}}function g(){S&&(s(u,50),s(l,50),s(d,50))}function p(n){var r=v.getCircularData(!0);if(r&&r.CircularTypes){I.circularLastUpdate=(new Date).getTime(),y.storeId=o.getSelectedStoreId(),C.length=0,C.push(function(){if(S.lastProcessDate!=(new Date).getDate()||!S.categoryById[-1]){var e=o.mapObject(r.Categories,"CategoryId");e[null]={CategoryId:null,CategoryName:""},e[-1]={CategoryId:-1,CategoryName:"Misc. Items"},e[-2]={CategoryId:-2,CategoryName:"Ingredients"},S.categoryById=e}});var i=o.mapObject(r.CircularTypes,"Code"),s=[],a=[],c=[],u=o.isNull(r.Circularz,r.Circulars);r.Circulars=[],e.forEach(u,function(t){if(t.StoreIds=t.StoreIds||[],t.CircularTypeName=(i[t.CircularTypeId]||{}).Name,t.StoreIds.length<=0||t.StoreIds.indexOf(y.storeId)>=0){r.Circulars.push(t),t.Pagez||(t.Pagez=t.Pages);var n=t.Pagez;t.Pages=[],e.forEach(n,function(e){(e.StoreIds.length<=0||e.StoreIds.indexOf(y.storeId)>=0)&&t.Pages.push(e)}),h(t,c,i,a,s)}}),C.push(function(){s.push({CircularTypeId:99,CircularType:"All Circulars",items:c}),o.sortOn(r.Circulars,"CircularTypeId")}),C.push(function(){S.itemsById=o.mapObject(c,"ItemId")}),C.push(function(){S.circularByTypeId=o.mapObject(s,"CircularTypeId")}),C.push(function(){S.staticCircularById=o.mapObject(a,"CircularTypeId")}),C.push(g),C.push(function(){n&&n(),S.lastProcessDate=(new Date).getDate(),t.$broadcast("gsnevent:circular-loaded",{success:!0,response:r})}),f()}}function f(){return C.length>0?(C.shift()(),void s(f,50)):void(S.processCompleted=new Date)}function h(t,n,r,i,s){var a=t.Pages,c=0;o.sortOn(a,"PageNumber"),t.pages=a,t.CircularType=r[t.CircularTypeId].Name;var u={CircularPageId:a[0].CircularPageId,CircularType:t.CircularType,CircularTypeId:t.CircularTypeId,ImageUrl:a[0].ImageUrl,SmallImageUrl:a[0].SmallImageUrl,items:[]};e.forEach(a,function(e){c+=e.Items.length,e.Circular=t,C.push(function(){m(n,u,e)})}),C.push(function(){o.isNull(c,0)>0?s.push(u):(u.items=a,i.push(u))})}function m(t,n,r){e.forEach(r.Items,function(e){e.PageNumber=parseInt(r.PageNumber),e.rect={x:0,y:0};var o=(e.AreaCoordinates+"").split(",");if(o.length>2){for(var i=0,s=0;4>s;s++)o[s]=parseInt(o[s])||0;o[0]>o[2]&&(i=o[0],o[0]=o[2],o[2]=i),o[1]>o[3]&&(i=o[1],o[1]=o[3],o[3]=i),e.rect.x=o[0],e.rect.y=o[1],e.rect.xx=o[2],e.rect.yy=o[3],e.rect.width=o[2]-o[0],e.rect.height=o[3]-o[1],e.rect.cx=e.rect.width/2,e.rect.cy=e.rect.height/2}n.items.push(e),e.SmallImageUrl=e.ImageUrl.replace("upload.gsngrocers.com/","upload.gsngrocers.com/rs/120,fit/"),e.Quantity=e.Quantity||1,t.push(e)})}var v={};t[n]=v,o.gsn.$store=v;var y={previousGetStore:null,manufacturerCoupons:{},instoreCoupons:{},youtechCoupons:{},quickSearchItems:{},topRecipes:{},faAskTheChef:{},faCookingTip:{},faArticle:{},faRecipe:{},faVideo:{},mealPlanners:{},manuCouponTotalSavings:{},states:{},adPods:{},specialAttributes:{},circular:null,allVideos:[]},I={},S={circularByTypeId:{},categoryById:{},itemsById:{},staticCircularById:{},storeCouponById:{},manuCouponById:{},youtechCouponById:{},processCompleted:0,lastProcessDate:0},C=[];return v.getCircular=function(e){var t=S.circularByTypeId[e];return t},v.getCategories=function(){return S.categoryById},v.getInventoryCategories=function(){var e=o.getStoreUrl()+"/GetInventoryCategories/"+o.getChainId()+"/"+o.getSelectedStoreId();return o.http({},e)},v.getSaleItemCategories=function(){var e=o.getStoreUrl()+"/GetSaleItemCategories/"+o.getChainId()+"/"+o.getSelectedStoreId();return o.http({},e)},v.refreshCircular=function(){if(!y.circularIsLoading){var e=o.getConfig();if(e.AllContent)return y.circularIsLoading=!0,void p(function(){y.circularIsLoading=!1});if(y.storeId=o.getSelectedStoreId(),!(y.storeId<=0)){y.circular={},y.circularIsLoading=!0,t.$broadcast("gsnevent:circular-loading");var n=o.getStoreUrl()+"/AllContent/"+y.storeId;o.http({},n).then(function(e){e.success?(y.circular=e.response,I.circular=e.response,p(),y.circularIsLoading=!1):(y.circularIsLoading=!1,t.$broadcast("gsnevent:circular-failed",e))})}}},v.searchProducts=function(e){var t=o.getStoreUrl()+"/SearchProduct/"+o.getSelectedStoreId()+"?q="+encodeURIComponent(e);return o.http({},t)},v.searchRecipes=function(e){var t=o.getStoreUrl()+"/SearchRecipe/"+o.getChainId()+"?q="+encodeURIComponent(e);return o.http({},t)},v.getAvailableVarieties=function(e){var t=o.getStoreUrl()+"/GetAvailableVarieties/"+e;return o.http({},t)},v.getQuickSearchItems=function(){var e=o.getStoreUrl()+"/GetQuickSearchItems/"+o.getChainId();return o.http(y.quickSearchItems,e)},v.getStores=function(){var e=i.defer();if(null!==o.isNull(y.previousGetStore,null))return y.previousGetStore.promise;y.previousGetStore=e;var n=I.storeList;return o.isNull(n,[]).length>0?s(function(){y.previousGetStore=null,c(n),e.resolve({success:!0,response:n})},10):(t.$broadcast("gsnevent:storelist-loading"),o.getAccessToken().then(function(){var n=o.getStoreUrl()+"/List/"+o.getChainId();r.get(n,{headers:o.getApiHeaders()}).success(function(n){y.previousGetStore=null;var r=n;c(r,!0),e.resolve({success:!0,response:r}),r.length>0&&t.$broadcast("gsnevent:storelist-loaded")})})),e.promise},v.getStore=function(){var e=i.defer();return v.getStores().then(function(t){var n=o.mapObject(t.response,"StoreId"),r=n[o.getSelectedStoreId()];e.resolve(r)}),e.promise},v.getItem=function(e){var t=S.itemsById[e];return null!==gsn.isNull(t,null)?t:null},v.getAskTheChef=function(){var e=o.getStoreUrl()+"/FeaturedArticle/"+o.getChainId()+"/1";return o.http(y.faAskTheChef,e)},v.getFeaturedArticle=function(){var e=o.getStoreUrl()+"/FeaturedArticle/"+o.getChainId()+"/2";return o.http(y.faArticle,e)},v.getFeaturedVideo=function(){var e=o.getStoreUrl()+"/FeaturedVideo/"+o.getChainId();return o.http(y.faVideo,e)},v.getRecipeVideos=function(){var e=o.getStoreUrl()+"/RecipeVideos/"+o.getChainId();return o.http(y.allVideos,e)},v.getCookingTip=function(){var e=o.getStoreUrl()+"/FeaturedArticle/"+o.getChainId()+"/3";return o.http(y.faCookingTip,e)},v.getTopRecipes=function(){var e=o.getStoreUrl()+"/TopRecipes/"+o.getChainId()+"/50";return o.http(y.topRecipes,e)},v.getFeaturedRecipe=function(){var e=o.getStoreUrl()+"/FeaturedRecipe/"+o.getChainId();return o.http(y.faRecipe,e)},v.getCoupon=function(e,t){return 2==t?S.manuCouponById[e]:10==t?S.storeCouponById[e]:S.youtechCouponById[e]},v.getManufacturerCoupons=function(){return y.manufacturerCoupons},v.getManufacturerCouponTotalSavings=function(){var e=o.getStoreUrl()+"/GetManufacturerCouponTotalSavings/"+o.getChainId();return o.http(y.manuCouponTotalSavings,e)},v.getStates=function(){var e=o.getStoreUrl()+"/GetStates";return o.http(y.states,e)},v.getInstoreCoupons=function(){return y.instoreCoupons},v.getYoutechCoupons=function(){return y.youtechCoupons},v.getRecipe=function(e){var t=o.getStoreUrl()+"/RecipeBy/"+e;return o.http({},t)},v.getStaticContent=function(e){var t=o.getStoreUrl()+"/GetPartials/"+o.getChainId()+"/",n=o.isNull(o.getSelectedStoreId(),0);return n>0&&(t+=n+"/"),t+="?name="+encodeURIComponent(e),o.http({},t)},v.getPartial=function(e){var t=o.getContentServiceUrl("GetPartial"),n=new Date,r=n.getFullYear()+""+n.getMonth()+n.getDate()+n.getHours();return t+="?name="+encodeURIComponent(e)+"&nocache="+r,o.http({},t)},v.getArticle=function(e){var t=o.getStoreUrl()+"/ArticleBy/"+e;return o.http({},t)},v.getSaleItems=function(e,t){var n=o.getStoreUrl()+"/FilterSaleItem/"+o.getSelectedStoreId()+"?departmentId="+o.isNull(e,"")+"&categoryId="+o.isNull(t,"");return o.http({},n)},v.getInventory=function(e,t){var n=o.getStoreUrl()+"/FilterInventory/"+o.getSelectedStoreId()+"?departmentId="+o.isNull(e,"")+"&categoryId="+o.isNull(t,"");return o.http({},n)},v.getSpecialAttributes=function(){var e=o.getStoreUrl()+"/GetSpecialAttributes/"+o.getChainId();return o.http(y.specialAttributes,e)},v.getMealPlannerRecipes=function(){var e=o.getStoreUrl()+"/GetMealPlannerRecipes/"+o.getChainId();return o.http(y.mealPlanners,e)},v.getAdPods=function(){var e=o.getStoreUrl()+"/ListSlots/"+o.getChainId();return o.http(y.adPods,e)},v.hasCompleteCircular=function(){var e=v.getCircularData(),t=!1;return e&&(t=o.isNull(e.Circulars,!1)),!t&&o.isNull(o.getSelectedStoreId(),0)>0&&(v.refreshCircular(),t=!1),v.getProcessDate()?t:null},v.getProcessDate=function(){return S.processCompleted},v.getCircularData=function(e){return y.circular||(y.circular=I.circular,e||p()),y.circular},v.initialize=function(t){o.initApp();var n=o.getConfig(),r=n.StoreList;r&&c(r,!0),v.getStores(),n.AllContent&&(n.AllContent.Circularz=n.AllContent.Circulars,n.AllContent.Circulars=[],e.forEach(n.AllContent.Circularz,function(e){e.Pagez=e.Pages,e.Pages=[]}),I.circular=n.AllContent),v.hasCompleteCircular()&&s(p,0),null!==o.isNull(t,null)&&(v.getAdPods(),v.getManufacturerCouponTotalSavings())},t.$on("gsnevent:store-setid",function(e,t){var n=t.newValue,r=o.getConfig(),i=o.isNull(y.storeId,0)!=n,s=i&&!r.AllContent;i&&(y.storeId=n,y.circularIsLoading=!1);var a=(new Date).getTime(),c=(a-o.isNull(I.circularLastUpdate,0))/1e3;s&&!y.circularIsLoading||c>1200?v.refreshCircular():i&&p()}),v}var n="gsnStore";e.module("gsn.core").service(n,["$rootScope","$http","gsnApi","$q","$timeout","$location",t])}(angular),function(e){"use strict";function t(e,t,r,o,i,s){function a(){return{youtechCouponUrl:t.isNull(t.getYoutechCouponUrl(),""),cardCouponResponse:null,availableCouponById:{},takenCouponById:{},redeemedCouponById:{},isValidResponse:!1,currentProfile:{}}}function c(){return t.isNull(S.currentProfile.ExternalId,"").length>0}function u(){return c()&&t.isNaN(parseFloat(S.currentProfile.ExternalId),0)<48203769258}function l(){return c()&&S.isValidResponse}function d(e){return g(e)||p(e)}function g(e){return null!==t.isNull(S.availableCouponById[e],null)}function p(e){return null!==t.isNull(S.takenCouponById[e],null)}function f(e){return null!==t.isNull(S.redeemedCouponById[e],null)}function h(t,n,r,o){n.resolve({success:!1,response:o}),e.$broadcast(t,r)}function m(n){var r=i.defer();return t.getAccessToken().then(function(){var o=S.youtechCouponUrl+"/AddToCard/"+t.getProfileId()+"/"+n;s.post(o,{},{headers:t.getApiHeaders()}).success(function(t){S.takenCouponById[n]=!0,S.availableCouponById[n]=null,r.resolve({success:!0,response:t}),e.$broadcast("gsnevent:youtech-cardcoupon-added",n)}).error(function(e){h("gsnevent:youtech-cardcoupon-addfail",r,n,e)})}),r.promise}function v(n){var r=i.defer();return t.getAccessToken().then(function(){var o=S.youtechCouponUrl+"/RemoveFromCard/"+t.getProfileId()+"/"+n;s.post(o,{},{headers:t.getApiHeaders()}).success(function(t){t.Success?(S.availableCouponById[n]=!0,S.takenCouponById[n]=null,r.resolve({success:!0,response:t}),e.$broadcast("gsnevent:youtech-cardcoupon-removed",n)):h("gsnevent:youtech-cardcoupon-removefail",r,n,t.Message)}).error(function(e){h("gsnevent:youtech-cardcoupon-removefail",r,n,e)})}),r.promise}function y(){t.getAccessToken().then(function(){var n=S.youtechCouponUrl+"/GetProfileCoupons/"+t.getProfileId();s.get(n,{headers:t.getApiHeaders()}).success(function(n){if(n.Success){var r=0;S.isValidResponse=!0;try{if(S.cardCouponResponse=n.Response,S.cardCouponResponse.availableCoupons&&(S.availableCouponById=t.mapObject(S.cardCouponResponse.availableCoupons.coupon,"couponId")),S.cardCouponResponse.available_ids)for(S.availableCouponById={},r=0;r<S.cardCouponResponse.available_ids.length;r++)S.availableCouponById[S.cardCouponResponse.available_ids[r]]=!0;S.cardCouponResponse.takenCoupons&&(S.takenCouponById=t.mapObject(S.cardCouponResponse.takenCoupons.coupon,"couponId"));var o=t.isNull(S.cardCouponResponse.taken_ids,S.cardCouponResponse.clipped_active_ids);if(o)for(S.takenCouponById={},r=0;r<o.length;r++)S.takenCouponById[o[r]]=!0;if(o=S.cardCouponResponse.clipped_redeemed_ids)for(S.redeemedCouponById={},r=0;r<o.length;r++)S.takenCouponById[o[r]]=!0,S.redeemedCouponById[o[r]]=!0}catch(i){}return void e.$broadcast("gsnevent:youtech-cardcoupon-loaded",I)}S=a(),e.$broadcast("gsnevent:youtech-cardcoupon-loadfail",I)}).error(function(){S.isValidResponse=!1,e.$broadcast("gsnevent:youtech-cardcoupon-loadfail",I)})})}var I={isValidCoupon:d,hasValidCard:l,addCouponTocard:m,removeCouponFromCard:v,isOldRoundyCard:u,isAvailable:g,isOnCard:p,hasRedeemed:f,hasCard:c,enable:!0},S=a();return e[n]=I,e.$on("gsnevent:logout",function(){I.enable&&(S=a())}),e.$on("gsnevent:profile-load-success",function(e,t){I.enable&&(a(),S.youtechCouponUrl.length>2&&(S.currentProfile=t.response,y()))}),e.$on("gsnevent:store-persisted",function(){I.enable&&(a(),S.currentProfile&&S.youtechCouponUrl.length>2&&y())}),I}var n="gsnYoutech";e.module("gsn.core").service(n,["$rootScope","gsnApi","gsnProfile","gsnStore","$q","$http",t])}(angular),function(e){"use strict";function t(){var e={restrict:"EA",scope:!0,controller:r};return e}function n(t,n,r,o,i,s,a){function c(){i.getStores().then(function(e){t.stores=e.response}),n.getProfile().then(function(n){n.success&&(t.profile=e.copy(n.response),t.isFacebook=r.isNull(t.profile.FacebookUserId,"").length>0)}),t.profileUpdated="/profile/rewardcard/updated"==t.currentPath}t.activate=c,t.profile={PrimaryStoreId:r.getSelectedStoreId(),ReceiveEmail:!0},t.hasSubmitted=!1,t.isValidSubmit=!0,t.isSubmitting=!1,t.profileStatus={profileUpdated:0},t.disableNavigation=!1,t.profileUpdated=!1,t.isFacebook=!1,t.updateProfile=function(){t.$broadcast("autofill:update");var e=t.profile;if(t.myForm.$valid){if(t.isSubmitting)return;t.hasSubmitted=!0,t.isSubmitting=!0,n.updateProfile(e).then(function(o){t.isSubmitting=!1,t.isValidSubmit=o.success,o.success&&(r.setSelectedStoreId(e.PrimaryStoreId),n.getProfile(!0),s.$broadcast("gsnevent:updateprofile-successful",o),a.eventTrack("profile-update",{category:"profile",label:o.response.ReceiveEmail}),t.disableNavigation||t.goUrl("/profile/rewardcardupdate"))})}},t.activate(),t.$on("gsnevent:updateprofile-successful",function(){t.profileStatus.profileUpdated++})}var r="ctrlAccount";e.module("gsn.core").controller(r,["$scope","gsnProfile","gsnApi","$timeout","gsnStore","$rootScope","$analytics",n]).directive(r,t)}(angular),function(e){"use strict";function t(){var e={restrict:"EA",scope:!0,controller:r};return e}function n(t,n,r){function o(){n.getProfile().then(function(n){n.success&&(t.profile=e.copy(n.response))})}t.activate=o,t.profile={PrimaryStoreId:r.getSelectedStoreId(),ReceiveEmail:!0},t.hasSubmitted=!1,t.isValidSubmit=!0,t.isSubmitting=!1,t.changePassword=function(){var e=t.profile;if(t.myForm.$valid){if(t.isSubmitting)return;t.hasSubmitted=!0,t.isSubmitting=!0,n.changePassword(e.UserName,e.currentPassword,e.newPassword).then(function(e){t.isSubmitting=!1,t.isValidSubmit=e.success})}},t.activate()}var r="ctrlChangePassword";e.module("gsn.core").controller(r,["$scope","gsnProfile","gsnApi",n]).directive(r,t)}(angular),function(e){"use strict";function t(){var e={restrict:"EA",scope:!0,controller:r};return e}function n(t,n,r,o,i,s,a){function c(){i.getStores().then(function(e){t.stores=e.response,t.storesById=r.mapObject(t.stores,"StoreId")}),n.getProfile().then(function(n){n.success&&(t.masterVm=e.copy(n.response),t.doReset())}),t.topics=r.groupBy(u(),"ParentOption"),t.topicsByValue=r.mapObject(t.topics,"key"),t.parentTopics=t.topicsByValue[""],t.topicsByValue=r.del(t.topicsByValue[""])}function u(){return[{Value:"Company",Text:"Company",ParentOption:""},{Value:"Store",Text:"Store (specify store below)",ParentOption:""},{Value:"Other",Text:"Other (specify below)",ParentOption:""},{Value:"Employment",Text:"Employment",ParentOption:""},{Value:"Website",Text:"Website",ParentOption:""},{Value:"Pharmacy",Text:"Pharmacy (specify store below)",ParentOption:""}]}t.activate=c,t.vm={PrimaryStoreId:r.getSelectedStoreId(),ReceiveEmail:!0},t.masterVm={PrimaryStoreId:r.getSelectedStoreId(),ReceiveEmail:!0},t.hasSubmitted=!1,t.isValidSubmit=!0,t.isSubmitting=!1,t.errorResponse=null,t.contactSuccess=!1,t.topics=[],t.topicsByValue={},t.storeList=[],t.captcha={},t.storesById={};var l;a.get(t.getThemeUrl("/views/email/contact-us.html")).success(function(e){l=e.replace(/data-ctrl-email-preview/gi,"")}),t.getSubTopics=function(){return t.topicsByValue[t.vm.Topic]},t.getFullStateName=function(e){return"========="+e.LinkState.FullName+"========="},t.getStoreDisplayName=function(e){return e.StoreName+" - "+e.PrimaryAddress+"(#"+e.StoreNumber+")"},t.doSubmit=function(){var e=t.vm;if(t.myContactUsForm.$valid){if(e.CaptchaChallenge=t.captcha.challenge,e.CaptchaResponse=t.captcha.response,e.Store=t.getStoreDisplayName(t.storesById[e.PrimaryStoreId]),t.email=e,e.EmailMessage=s(l)(t),t.isSubmitting)return;t.hasSubmitted=!0,t.isSubmitting=!0,t.errorResponse=null,n.sendContactUs(e).then(function(e){t.isSubmitting=!1,t.isValidSubmit=e.success,e.success?t.contactSuccess=!0:t.errorResponse="string"==typeof e.response?e.response:r.getServiceUnavailableMessage()})}},t.doReset=function(){t.vm=e.copy(t.masterVm),t.vm.ConfirmEmail=t.vm.Email},t.activate()}var r="ctrlContactUs";e.module("gsn.core").controller(r,["$scope","gsnProfile","gsnApi","$timeout","gsnStore","$interpolate","$http",n]).directive(r,t)}(angular),function(e){"use strict";function t(){var e={restrict:"EA",scope:!0,controller:r};return e}function n(e,t,n){function r(){e.fromUrl=decodeURIComponent(t.isNull(n.search().fromUrl,"")),e.isLoggedIn?e.goUrl(e.fromUrl.length>0?e.fromUrl:"/"):e.gvm.loginCounter++}e.activate=r,e.fromUrl="/",e.activate()}var r="ctrlLogin";e.module("gsn.core").controller(r,["$scope","gsnApi","$location",n]).directive(r,t)}(angular),function(e){"use strict";function t(){var e={restrict:"EA",scope:!0,controller:r};return e}function n(e,t,n,r,o,i){function s(){"/savedlists"==e.currentPath?e.doInitializeForSavedLists():r(function(){n.getShoppingList()&&o.$broadcast("gsnevent:shoppinglist-page-loaded",n.getShoppingList())},500),e.circular=i.getCircularData()}e.activate=s,e.listviewList=[],e.selectedShoppingListId=0,e.hasInitializePrinter=!1,e.circular={Circulars:[]},e.doInitializeForSavedLists=function(){e.listviewList.length=0;var r=t.isNull(n.getShoppingLists(),[]);if(!(r.length<1))for(var o=0;o<r.length;o++){var i=r[o];2==i.getStatus()&&(i.text=i.getTitle(),e.listviewList.push(i),e.selectedShoppingListId<1&&(e.selectedShoppingListId=i.ShoppingListId))}},e.startNewList=function(){var r=n.getShoppingList();t.isNull(r.allItems(),[]).length<=0&&n.deleteShoppingList(r),n.createNewShoppingList().then(function(){s(),e.$broadcast("gsnevent:shopping-list-created")})},e.deleteCurrentList=function(){var t=n.getShoppingList();n.deleteShoppingList(t),n.createNewShoppingList().then(function(){s(),e.$broadcast("gsnevent:shopping-list-deleted")})},e.getSelectedShoppingListId=function(){return e.selectedShoppingListId},e.canDeleteList=function(){return e.selectedShoppingListId!==n.getShoppingListId()&&0!==n.getShoppingListId()},e.setSelectedShoppingListId=function(t){e.selectedShoppingListId=t,e.$broadcast("gsnevent:savedlists-selected",{ShoppingListId:t})},e.$on("gsnevent:shoppinglists-loaded",s),e.$on("gsnevent:shoppinglists-deleted",s),e.$on("gsnevent:shoppinglist-created",s),e.$on("gsnevent:savedlists-deleted",function(){e.doInitializeForSavedLists(),e.$broadcast("gsnevent:savedlists-selected",{ShoppingListId:e.selectedShoppingListId})}),e.$on("gsnevent:shopping-list-saved",function(){n.refreshShoppingLists()}),e.activate()}var r="ctrlShoppingList";e.module("gsn.core").controller(r,["$scope","gsnApi","gsnProfile","$timeout","$rootScope","gsnStore",n]).directive(r,t)}(angular),function(e){var t,n,r,o,i,s;for(n=e.module("gsn.core"),t=function(e){return n.directive(e,["$timeout",function(e){return{restrict:"AC",link:function(t,n){function r(){"undefined"!=typeof FB&&null!==FB?FB.XFBML.parse(n.parent()[0]):e(r,500)}e(r,500)}}}])},s=["fbActivity","fbComments","fbFacepile","fbLike","fbLikeBox","fbLiveStream","fbLoginButton","fbName","fbProfilePic","fbRecommendations"],o=0,i=s.length;i>o;o++)r=s[o],t(r)}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnAdUnit",["gsnStore","$timeout","gsnApi","$rootScope","$http","$templateCache","$interpolate",function(e,t,n,r,o,i,s){function a(t,a,c){function u(){if(l.length>0){if(p&&t.templateHtml){a.html(t.templateHtml);var e=s(t.templateHtml)(t);a.html(e),r.$broadcast("gsnevent:loadads")}}else p&&(a.find(".gsnadunit").addClass("brickunit"),r.$broadcast("gsnevent:loadads"))}t.templateHtml=null;var l=n.isNull(c.gsnAdUnit,"");if(l.length>0){var d=n.getThemeUrl("/../common/views/tile"+l+".html"),g=o.get(d,{cache:i}),p=!1;g.success(function(e){t.templateHtml=e}).then(u)}e.getAdPods().then(function(e){if(e.success){if(c.gsnAdUnit)for(var t=0;t<e.response.length;t++){var n=e.response[t];if(n.Code==c.gsnAdUnit){p=!0;break}}else p=!0;u()}})}var c={restrict:"A",link:a};return c}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnAutoFillSync",["$timeout",function(){function e(e,t,n,r){e.$on("autofill:update",function(){r.$setViewValue(t.val())})}var t={restrict:"A",require:"ngModel",link:e};return t}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnCarousel",["gsnApi","$timeout","$window",function(t,n,r){function o(o,i,s){function a(){var i=o.$eval(s.slides);if(t.isNull(i,[]).length<=0)return void n(a,200);o.slides=i,o.selectIndex(0);var c=e.element(r);c.blur(function(){d=o.isPlaying(),o.stop()}),c.focus(function(){d&&o.play()})}function c(e,n){var r=e+n;return r=(0>r?o.slides.length-1:r)%o.slides.length,t.isNaN(r,0)}var u,l={interval:s.interval,reverse:s.reverse|!1},d=!1,g=!1;o.$slideIndex=0,o.activate=a,o.slides=[],o.isPlaying=function(){return g},o.play=function(){return o.stop(),g=!0,u=n(o.next,l.interval),o.$slideIndex},o.stop=function(){if(g&&null!==t.isNull(u,null))try{n.cancel(u)}catch(e){}g=!1},o.next=function(){n(function(){return o.$slideIndex=c(o.play(),1)},5)},o.prev=function(){n(function(){return o.$slideIndex=c(o.play(),-1)},5)},o.selectIndex=function(e){n(function(){return o.$slideIndex=e,o.play()},5)},o.currentSlide=function(){return o.slides[o.currentIndex()]},o.addSlide=function(e){return o.slides.push(e)},o.removeSlide=function(e){var t=o.indexOf(e);return slides.splice(t,1)},o.indexOf=function(e){if("undefined"!=typeof e.indexOf)return e.indexOf(e);if("undefined"!=typeof o.slides.length)for(var t=0;t<o.slides.length;t++)if(o.slides[t]==e)return t;return-1},o.currentIndex=function(){var e=(o.slides.length-o.$slideIndex-1)%o.slides.length;return e=0>e?0:o.slides.length-1,l.reverse?e:o.$slideIndex},o.$watch("$slideIndex",function(e){var t=c(o.$slideIndex,0);t!=e&&n(function(){return o.$slideIndex=t},5)}),o.$on("$destroy",o.stop),o.activate()}var i={link:o,restrict:"EA",scope:!0};return i}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnCouponPopover",["$window",function(t){function n(t,n){var r=e.element;if(r(t)[0].scrollHeight>97&&!r(t.find(".ellipsis")).length){var o=!1;r(t).css("height","96px"),r(t).append('<button class="ellipsis pull-right">...</button>'),r(t.find(".ellipsis")).popover({html:!0,content:n.popoverHtml,placement:"top",container:"body",trigger:"manual"}),r(t.find(".ellipsis")).bind("click",function(){r(".popover").length?r(this).blur():r(this).focus()}),r(t.find(".ellipsis")).bind("mouseover",function(){r(".popover").length||r(this).focus()}),r(t.find(".ellipsis")).bind("mouseout",function(){o||r(this).blur()}),r(t.find(".ellipsis")).bind("blur",function(){r(this).popover("hide"),o=!1}),r(t.find(".ellipsis")).bind("focus",function(){r(this).popover("show")}),r(t.find("p")).bind("click",function(){var e=r(t.find(".ellipsis"));r(".popover").length?e.blur():(e.focus(),o=!0)})}r(t)[0].clientHeight==r(t)[0].scrollHeight&&r(t.find(".ellipsis")).length&&(r(t.find(".ellipsis")).remove(),r(t.find("p")).unbind("click"))}function r(e,r,o){e.$watch("$viewContentLoaded",function(){n(r,o)}),e.$watch(function(){return t.innerWidth},function(){n(r,o)})}var o={restrict:"EA",scope:!0,link:r};return o}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnDigitalCirc",["$timeout","$rootScope","$analytics","gsnApi","$location",function(e,t,n,r){function o(o,i,s){o.$watch(s.gsnDigitalCirc,function(o){if(o&&o.Circulars.length>0){var s=i.find("div");s.digitalCirc({data:o,browser:r.browser,onItemSelect:function(n,r,o){e(function(){t.$broadcast("gsnevent:digitalcircular-itemselect",o)},50)},onCircularDisplaying:function(r,o,i){e(function(){t.$broadcast("gsnevent:digitalcircular-pagechanging",{plugin:r,circularIndex:o,pageIndex:i})},50);var s=r.getCircular(o);return s&&n.eventTrack("PageChange",{category:"Circular_Type"+s.CircularTypeId+"_P"+(i+1),label:s.CircularDescription}),!1}})}})}var i={restrict:"EA",scope:!1,link:o};return i}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnDynamic",["$compile",function(e){function t(t,n,r){t.$watch(r.dynamic,function(r){n.html(r),e(n.contents())(t)})}var n={restrict:"A",replace:!0,link:t};return n}])}(angular),function(e){var t,n,r,o,i,s;for(n=e.module("gsn.core"),t=function(e){return n.directive(e,["gsnStore","gsnApi",function(t,n){return{restrict:"AC",scope:!0,link:function(r,o,i){n.getSelectedStoreId();if(i.contentPosition){var s=n.parseStoreSpecificContent(n.getHomeData().ContentData[i.contentPosition]);if(s&&s.Description)return void o.html(s.Description)}r.item={},"gsnFtArticle"==e?t.getFeaturedArticle().then(function(e){e.success&&(r.item=e.response)}):"gsnFtRecipe"==e?t.getFeaturedRecipe().then(function(e){e.success&&(r.item=e.response)}):"gsnFtAskthechef"==e?t.getAskTheChef().then(function(e){e.success&&(r.item=e.response)}):"gsnFtVideo"==e?t.getFeaturedVideo().then(function(e){e.success&&(r.item=e.response)}):"gsnFtCookingtip"==e?t.getCookingTip().then(function(e){e.success&&(r.item=e.response)}):"gsnFtConfig"==e&&(r.item=n.parseStoreSpecificContent(n.getHomeData().ConfigData[i.gsnFtConfig]),i.overwrite&&(r.item.Description||"").length>0&&o.html(r.item.Description))}}}])},s=["gsnFtArticle","gsnFtRecipe","gsnFtAskthechef","gsnFtCookingtip","gsnFtVideo","gsnFtConfig","gsnFtContent"],o=0,i=s.length;i>o;o++)r=s[o],t(r)}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnFlexibleWidth",["debounce","$window",function(t,n){function r(r,o){function i(){o.css({width:o.parent()[0].offsetWidth+"px"})}var s=t(i,200);e.element(n).on("resize",s),s()}var o={restrict:"EA",scope:!0,link:r};return o}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnFlowPlayer",["$timeout","gsnApi","$rootScope","$routeParams",function(t,n,r,o){function i(n,i,s){n.play=function(e,t){n.videoTitle=t,n.videoName=name,flowplayer(s.gsnFlowPlayer,s.swf,{clip:{url:e,autoPlay:!0,autoBuffering:!0}}),r.$broadcast("gsnevent:loadads")},o.title&&(n.videoTitle=o.title),t(function(){var t=e.element('a[title="'+n.vm.featuredVideo.Title+'"]');t.click()},500)}var s={restrict:"EA",replace:!0,scope:!0,link:i};return s}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnFluidVids",["$sce",function(e){function t(t,n,r){n.on("scroll",function(){var e=r.height/r.width*100;n[0].style.paddingTop=e+"%"}),t.video=e.trustAsResourceUrl(r.gsnFluidVids)}var n={restrict:"EA",replace:!0,scope:!0,link:t,template:'<div class="fluidvids"><iframe data-ng-src="{{ video }}" allowfullscreen="" frameborder="0"></iframe></div>'};return n}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnFrame",["$interpolate","$http","$templateCache","gsnApi",function(e,t,n,r){function o(o,i,s){var a=r.getThemeUrl(s.gsnFrame),c=t.get(a,{cache:n});o.templateHtml="",c.success(function(e){o.templateHtml=e}).then(function(){var t=e(o.templateHtml)(o.item);t=t.replace("<title></title>","<title>"+o.item.Title+"</title>"),t=t.replace("<body></body>","<body>"+o.item.Description+"</body>");var n=r.loadIframe(i,t);n.setAttribute("width","100%"),n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),n.setAttribute("id","static-content-frame")})}var i={restrict:"A",scope:{item:"="},link:o};return i}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnHoverSync",["$window","$timeout","debounce",function(t,n,r){function o(t,n,o){var i=r(function(){var t=n.parent().offset(),r=n.offset(),i=n[0].getBoundingClientRect(),s=e.element(o.gsnHoverSync);s.css({top:r.top-t.top,left:r.left-t.left,width:i.width,height:i.height}).show(),i.height<60?s.addClass("link-inline"):s.removeClass("link-inline")},200);n.on("mouseover",i),n.on("click",i)}var i={link:o,restrict:"A"};return i}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnHtmlCapture",["$window","$timeout",function(e,t){function n(e,n,r){var o=parseInt(r.timeout),i=o>0;0>=o&&(o=200);var s=function(){e.$apply(r.gsnHtmlCapture+' = "'+n.html().replace(/"/g,'\\"')+'"');var a=e[r.gsnHtmlCapture].replace(/\s+/gi,"").length<=0;return a?void t(s,o):void(i&&t(s,o))};t(s,o)}var r={link:n,restrict:"A"};return r}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnLogin",["gsnApi","$route","$routeParams","$location","gsnProfile",function(e,t,n,r,o){function i(i,s){function a(){i.fromUrl=decodeURIComponent(e.isNull(n.fromUrl,""))}i.activate=a,i.profile={},i.fromUrl=null,i.hasSubmitted=!1,i.isValidSubmit=!0,i.isSubmitting=!1,i.$on("gsnevent:login-success",function(){"/signin"==i.currentPath?i.fromUrl?r.url(i.fromUrl):i.isLoggedIn&&r.url("/"):t.reload(),i.$emit("gsnevent:closemodal")}),i.$on("gsnevent:login-failed",function(){i.isValidSubmit=!1,i.isSubmitting=!1
}),i.login=function(){i.isSubmitting=!0,i.hasSubmitted=!0,o.login(s.find("#usernameField").val(),s.find("#passwordField").val())},i.activate()}var s={restrict:"EA",controller:["$scope","$element","$attrs",i]};return s}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnModal",["$compile","$timeout","$location","$http","$templateCache","$rootScope","gsnApi",function(t,n,r,o,i,s,a){function c(c,u,l){function d(){y=new Date,h&&(h.property||(h.property=y.getTime()-v.getTime()),s.$broadcast("gsnevent:gsnmodal-hide",u,h),"function"==typeof m&&m())}var g,p,f,h,m,v,y,I;f=c.$eval(l.gsnModal),c.$location=r,g="",p=o.get(f,{cache:i}).success(function(e){return g='<div class="myModalForm" style="display: block"><div class="modal-dialog">'+e+'</div></div>"'}),l.track&&(h=c.$eval(l.track)),m=c.$eval(l.hideCb),c.closeModal=function(){return null!=I&&n.cancel(I),gmodal.hide()},c.openModal=function(n){s.$broadcast("gsnevent:gsnmodal-show",u,h),v=new Date,null!=n&&null!=n.preventDefault&&n.preventDefault();var r=!1;return l.forceShow&&(r=!0),(!gmodal.isVisible||r)&&(l.item&&(c.item=c.$eval(l.item)),p.then(function(){var n=e.element(t(g)(c));return gmodal.show({content:n[0],hideOn:l.hideOn||"click,esc,tap",cls:l.cls,timeout:l.timeout,closeCls:l.closeCls||"close modal",disableScrollTop:l.disableScrollTop},d)})),c},c.hideModal=c.closeModal,c.showModal=c.openModal,c.goUrl=function(e,t){return"_blank"==a.isNull(t,"")?void $window.open(e,""):(r.url(e),void c.closeModal())},l.showIf&&c.$watch(l.showIf,function(e){e>0&&(I=n(c.openModal,1550))}),l.show&&c.$watch(l.show,function(e){e?I=n(c.openModal,550):n(c.closeModal,550)}),l.eventToClose&&c.$on(l.eventToClose,function(){n(c.closeModal,5)})}var u={link:c,scope:!0,restrict:"AE"};return u}])}(angular),function(e,t){"use strict";var n=e.module("gsn.core");n.directive("numbersOnly",function(){return{require:"ngModel",link:function(e,n,r,o){o.$parsers.push(function(e){if(e===t)return"";var n=e.replace(/[^0-9]/g,"");return n!=e&&(o.$setViewValue(n),o.$render()),n})}}})}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnPartial",["$timeout","gsnStore","gsnApi",function(t,n,r){function o(t,o,i){function s(){var e=t.contentName;"2"==t.version?n.getPartial(e).then(function(e){e.success?a(e.response):t.notFound=!0}):n.getStaticContent(e).then(function(e){e.success?c(e.response):t.notFound=!0})}function a(e){e&&c(e.Contents||[])}function c(n){var o=!1,i=[];if(!e.isArray(n)||r.isNull(n,[]).length<=0)return void(t.notFound=!0);r.sortOn(n,"SortBy");for(var s=0;s<n.length;s++){var a=n[s];a.IsMetaData||(i.push(a),!o&&a.Description&&(o=/<\/script>/gi.test(a.Description+"")))}t.hasScript=o,n.length>=1&&(t.firstContent=i[0]),t.partialContents=i}t.version=i.version||"1",t.activate=s,t.notFound=!1,t.hasScript=!1,t.partialContents=[],t.firstContent={},t.searchContentName=r.isNull(i.gsnPartial.replace(/^\/+/gi,""),"").replace(/[\-]/gi," "),t.contentName=e.lowercase(t.searchContentName),t.activate()}var i={link:o,restrict:"EA",scope:!0};return i}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnPartialContent",["$timeout","gsnStore","gsnApi","$location",function(t,n,r,o){function i(t,i,s){function a(){var e=t.contentDetail.url.split("/");e.length>1&&(t.contentDetail.subName=e[1]),t.contentDetail.name=e[0],t.contentDetail.url.indexOf(".aspx")>0||n.getPartial(t.contentDetail.name).then(function(e){t.pcvm.hasScript=!1,t.pcvm.isLoading=!1,e.success&&(t.pcvm.notFound="null"==e.response,c(e.response))})}function c(e){l=r.parsePartialContentData(e),t.partialContents=t.getContentList(),t.pcvm.layout=t.getConfig("layout").Description||"default"}var u=e.lowercase(r.isNull(o.path().replace(/^\/+/gi,""),"").replace(/[\-]/gi," "));s.gsnPartialContent=s.gsnPartialContent||u,t.activate=a,t.pcvm={hasScript:!1,notFound:!1,isLoading:!0,layout:"default",tab:o.search().tab||0},t.partialContents=[],t.contentDetail={url:r.isNull(s.gsnPartialContent.replace(/^\/+/gi,""),"").replace(/[\-]/gi," "),name:"",subName:""};var l={ContentData:{},ConfigData:{},ContentList:[]};t.getContentList=function(){var n=[];if(l.ContentList)for(var o=0;o<l.ContentList.length;o++){var i=r.parseStoreSpecificContent(l.ContentList[o]);if(i.Headline||i.SortBy){if(/<script.+src=/gi.test(i.Description||"")&&(t.pcvm.hasScript=!0),r.isNull(t.contentDetail.subName,0).length<=0){n.push(i);continue}(e.lowercase(i.Headline||"")==t.contentDetail.subName||i.SortBy==t.contentDetail.subName)&&n.push(i)}}return n},t.getContent=function(e){return r.parseStoreSpecificContent(l.ContentData[e])},t.getConfig=function(e){return r.parseStoreSpecificContent(l.ConfigData[e])||{}},t.getConfigDescription=function(e,n){var o=t.getConfig(e).Description;return r.isNull(o,n)},t.activate()}var s={link:i,restrict:"EA",scope:!0};return s}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnPathPixel",["$sce","gsnApi","$interpolate",function(t,n,r){function o(o,i,s){var a="";o.$on("$routeChangeSuccess",function(){var c=e.lowercase(n.isNull(s.path,""));if(c.length<=0||n.isNull(o.currentPath,"").indexOf(c)>=0){if(a==o.currentPath)return;setTimeout(function(){if(i.html(""),a=o.currentPath,o.ProfileId=n.getProfileId(),o.CACHEBUSTER=(new Date).getTime(),!(o.ProfileId<=0&&s.gsnPathPixel.indexOf("ProfileId")>0)){o.StoreId=n.getSelectedStoreId(),o.ChainId=n.getChainId();var e=t.trustAsResourceUrl(r(s.gsnPathPixel.replace(/\[+/gi,"{{").replace(/\]+/gi,"}}"))(o)),c=new Image(1,1);c.src=e}},500)}})}var i={restrict:"EA",scope:!0,link:o};return i}])}(angular),function(e,t){"use strict";var n=e.module("gsn.core");n.directive("gsnPopover",["$window","$interpolate","$timeout",function(n,r,o){function i(){o(function(){e.element(".gsn-popover").slideUp()},500)}function s(n,s,a){var c="",u=a.title||"";o(function(){c=e.element(a.selector).html()||""},50);var l=e.element(".gsn-popover");if(l.length>0){var d=t;s.mousemove(function(t){e.element(".gsn-popover .popover-title").html(r("<div>"+u+"</div>")(n).replace("data-ng-src","src")),e.element(".gsn-popover .popover-content").html(r("<div>"+c+"</div>")(n).replace("data-ng-src","src"));e.element(this).offset(),l.show().height();e.element(".gsn-popover").css({top:t.clientY+15,left:t.clientX+15}).show(),d&&clearTimeout(d),d=setTimeout(i,1500)}).mouseleave(function(){d&&clearTimeout(d),d=setTimeout(i,500)}),l.mousemove(function(){d&&clearTimeout(d),d=setTimeout(i,1500)})}else s.qtip({content:{text:function(){var e=r("<div>"+c+"</div>")(n).replace("data-ng-src","src");return e},title:function(){var e=r("<div>"+u+"</div>")(n).replace("data-ng-src","src");return e.replace(/\s+/gi,"").length<=0?null:e}},style:{classes:a.classes||"qtip-light qtip-rounded qtip-shadow"},show:{event:"click mouseover",solo:!0},hide:{distance:1500},position:{at:"bottom left"}});n.$on("$destroy",function(){l.length<=0&&s.qtip("destroy",!0)})}var a={link:s,restrict:"AE"};return a}])}(angular),function(e,t){"use strict";var n=e.module("gsn.core");n.directive("gsnProfileInfo",["gsnApi","gsnProfile","$interpolate",function(e,n,r){function o(e,o,i){function s(){n.getProfile().then(function(n){if(n.success){e.profile=n.response,o.html("");var s="<p>welcome, "+e.profile.FirstName+" "+e.profile.LastName+"</p>";i.gsnProfileInfo?(a===t&&(a=r(i.gsnProfileInfo.replace(/\[+/gi,"{{").replace(/\]+/gi,"}}"))),s=a(e)):e.profile.FacebookUserId&&(s='<a href="/profile"><img alt="temp customer image" class="accountImage" src="http://graph.facebook.com/'+e.profile.FacebookUserId+'/picture?type=small" /></a>'+s),o.html(s)}})}var a;s(),e.$on("gsnevent:profile-load-success",s)}var i={restrict:"EA",scope:!0,link:o};return i}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnProposeApp",["gsnApi","$localStorage","$compile",function(t,n,r){function o(o){if(o.isIOS=t.browser.isIOS,o.isAndroid=t.browser.isAndroid,(t.browser.isMobile||o.isIOS||o.isAndroid)&&!n.hasMobileApp){var i="http://clientapi.gsngrocers.com/api/v1/content/meta/"+t.getChainId()+"/?name=home%20page&meta=mobileAppPage&type=text/html&nocache=",s=new Date,a=s.getFullYear()+""+s.getMonth()+s.getDate()+s.getHours();t.http({},i+a).then(function(t){if(t.success){var n='<div class="myModalForm" style="display: block"><div class="modal-dialog">'+t.response+'</div></div>"',i=e.element(r(n)(o));console.log("redirect to page or show PopUp"),gmodal.show({content:i[0]})}}),o.downloadApp=function(e){n.hasMobileApp=!0,t.goUrl(e,"_self")},o.rejectApp=function(){return n.hasMobileApp=!0,gmodal.hide()}}}var i={restrict:"A",scope:!0,link:o};return i}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnRssFeed",["FeedService","$timeout",function(e){function t(t,n,r){e.parseFeed(r.gsnRssFeed,r.maxResult).then(function(e){t[r.ngModel]=e.data.responseData.feed})}var n={link:t,restrict:"A"};return n}])}(angular),function(e){e.module("gsn.core").directive("gsnShoppingList",["gsnApi","$timeout","gsnProfile","$routeParams","$rootScope","gsnStore","$location","gsnCouponPrinter","$filter",function(t,n,r,o,i,s,a,c,u){function l(e){e.reloadShoppingList()}function d(o,a,l){function d(e,n){return null!==t.isNull(n,null)?t.isNull(o.mylist)||"savedlists"==l.gsnShoppingList?void o.reloadShoppingList():null===t.isNull(o.mylist,null)?void o.reloadShoppingList(n.ShoppingListId):void(n.ShoppingListId==o.mylist.ShoppingListId&&o.reloadShoppingList(o.mylist.ShoppingListId)):void 0}o.coupons=[],o.manufacturerCoupons=[],o.instoreCoupons=[],o.circularCoupons=[],o.addString="",o.pluginItemCount=10,o.topitems=[],o.hasInitializePrinter=!1,o.totalQuantity=0,o.mylist=null,o.groupBy="CategoryName",o.currentDate=new Date,o.shoppinglistsaved=0,o.shoppinglistdeleted=0,o.shoppinglistcreated=0,o.circular=s.getCircularData(),o.printer={blocked:0,notsupported:0,notinstalled:0,printed:null,count:0,total:0},o.reloadShoppingList=function(e){n(function(){"savedlists"==l.gsnShoppingList&&o.getSelectedShoppingListId&&(e=o.getSelectedShoppingListId()),o.mylist=o.doMassageList(r.getShoppingList(e)),o.mylist?o.mylist.hasLoaded()||o.doRefreshList():e&&"savedlists"!=l.gsnShoppingList&&e==t.getShoppingListId()&&(o.mylist=r.getShoppingList(),o.doRefreshList())},50)},o.doMassageList=function(n){if(null===t.isNull(n,null))return null;o.coupons.length=0,o.manufacturerCoupons.length=0,o.totalQuantity=0,o.title=n.getTitle(),o.currentDate=new Date,null===t.isNull(o.newTitle,null)&&(o.newTitle=n.getStatus()>1?o.title:null),n.topitems=[],n.items=t.isNull(n.items,[]),n.items.length=0;var r=n.allItems(),a=0;t.isNull(n.items,[]).length>0?r=n.items:n.items=r;var c=s.getCategories();e.forEach(r,function(e,n){if(null===t.isNull(e.CategoryName,null)){var r=c[e.CategoryId||null];e.CategoryName=r?t.isNull(r.CategoryName,""):t.isNull(e.CategoryName,"")}if(e.BrandName=t.isNull(e.BrandName,""),e.IsCoupon){var i=s.getCoupon(e.ItemId,e.ItemTypeId);if(i){e.ProductCode=i.ProductCode,e.StartDate=i.StartDate,e.EndDate=i.EndDate;var u=t.isNaN(parseInt(i.Quantity),0);e.Quantity=u>0?u:1,13==e.ItemTypeId&&(e.CategoryName="Digital Coupon"),10==e.ItemTypeId&&o.instoreCoupons.push(i)}o.coupons.push(e),2==e.ItemTypeId&&o.manufacturerCoupons.push(e)}else{var l=s.getItem(e.ItemId);l&&l.CouponImageUrl&&(e.CouponImageUrl=l.CouponImageUrl,e.Description2=l.ItemDescription,e.EndDate=o.circular.Circulars[0].EndDate,o.circularCoupons.push(e))}t.isNull(e.PriceString,"").length<=0&&e.Price&&(e.PriceString="$"+parseFloat(e.Price).toFixed(2)),a+=t.isNaN(parseInt(e.Quantity),0),e.NewQuantity=e.Quantity,e.selected=!1,e.zIndex=900-n}),o.totalQuantity=a,n.ShoppingListId==t.getShoppingListId()&&(t.sortOn(r,"Order"),n.topitems=e.copy(r),r.length>o.pluginItemCount&&(n.topitems=n.topitems.splice(r.length-o.pluginItemCount)),n.topitems.reverse(),o.topitems=n.topitems,i.$broadcast("gsnevent:shoppinglist-itemtops",o.topitems));var l=[];l=t.isNull(o.groupBy,"").length<=0?[{key:"",items:r}]:t.groupBy(r,o.groupBy,function(e){t.sortOn(e.items,"Description")});for(var d=0;d<l.length;d++){var g=l[d].items;t.isNull(o.listSearch,"").length<=0&&(g=u("filter")(g,o.listSearch)),l[d].fitems=g}return o.allItems=l,i.$broadcast("gsnevent:gsnshoppinglist-itemavailable"),n},o.doUpdateQuantity=function(e){var t=o.mylist;e.OldQuantity=e.Quantity,e.Quantity=parseInt(e.NewQuantity),t.syncItem(e)},o.doAddSelected=function(){var t=o.mylist,n=[];e.forEach(t.items,function(e){!0===e.selected&&n.push(e)}),e.forEach(n,function(e){!1===r.isOnList(e)?r.addItem(e):e.selected=!1})},o.doDeleteList=function(){r.deleteShoppingList(o.mylist),o.$emit("gsnevent:savedlists-deleted",o.mylist)},o.doAddOwnItem=function(){var e=o.mylist,n=t.isNull(o.addString,"");n.length<1||(r.addItem({ItemId:null,Description:o.addString,ItemTypeId:6,Quantity:1}),o.addString="",o.doMassageList(e))},o.doSaveList=function(e){if(!t.isLoggedIn())return void i.$broadcast("gsnevent:login-required");var n=o.mylist;n.setTitle(e).then(function(){})},o.doSelectAll=function(){var t=o.mylist;if(t.items[0]){var n=t.items[0].selected?!1:!0;e.forEach(t.items,function(e){e.selected=n})}},o.doItemRemove=function(e){var t=o.mylist;t.removeItem(e),o.doMassageList(t)},o.doItemAddToCurrentList=function(e){null!==gsn.isNull(e,null)&&r.addItem(e)},o.doRefreshList=function(){o.mylist&&o.mylist.updateShoppingList().then(function(e){e.success&&o.doMassageList(o.mylist)})},o.$on("gsnevent:shoppinglist-changed",d),o.$on("gsnevent:shoppinglist-loaded",d),o.$on("gsnevent:shoppinglist-page-loaded",d),o.$on("gsnevent:savedlists-selected",d),o.$on("gsnevent:circular-loaded",function(e,t){t.success&&o.reloadShoppingList(),o.circular=s.getCircularData()}),o.$on("gsnevent:shopping-list-saved",function(){o.shoppinglistsaved++}),o.$on("gsnevent:shopping-list-deleted",function(){o.shoppinglistdeleted++}),o.$on("gsnevent:shopping-list-created",function(){o.shoppinglistcreated++}),o.$on("gsnevent:gsnshoppinglist-itemavailable",function(){o.manufacturerCoupons.length<=0||o.hasInitializePrinter||o.currentPath.indexOf("print")>0&&(o.hasInitializePrinter=!0,o.manufacturerCoupons.length>0&&o.canPrint&&(o.printer.print=null,o.printer.total=o.manufacturerCoupons.length,c.print(o.manufacturerCoupons)))}),o.$on("gsnevent:gcprinter-not-supported",function(){o.printer.notsupported++}),o.$on("gsnevent:gcprinter-blocked",function(){o.printer.blocked++}),o.$on("gsnevent:gcprinter-not-found",function(){o.printer.notinstalled++}),o.$on("gsnevent:gcprinter-printed",function(e,n,r){if(o.printer.printed=n,r){o.printer.errors=t.isNull(r.ErrorCoupons,[]);var i=o.printer.total-o.printer.errors.length;i>0&&(o.printer.count=i)}})}var g={restrict:"EA",scope:!0,controller:["$scope","$element","$attrs",d],link:l};return g}])}(angular),function(e,t){"use strict";var n=e.module("gsn.core");n.directive("gsnSiteSearch",["$routeParams","$timeout","gsnApi","$window",function(e,n,r,o){function i(i,s,a){function c(){if(t===o.google||t===o.google.load){if(n(c,500),u)return;u=!0;var i="//www.google.com/jsapi";return void r.loadScripts([i],c)}google.load("search","1",{language:"en",callback:function(){var t=new google.search.CustomSearchControl(r.getGoogleSiteSearchCode());t.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET),t.setLinkTarget(google.search.Search.LINK_TARGET_SELF),t.draw(a.id),a.query&&t.execute(e[a.query])}})}var u=!1;n(c,500)}var s={link:i,restrict:"A"};return s}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnSpinner",["$window","$timeout","gsnApi",function(e,t,n){function r(e,t,n){}var o={link:r,restrict:"A",scope:!0};return o}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnSticky",["$window","$timeout","debounce",function(t,n,r){function o(n,o,i){function s(){var n=e.element(t).scrollTop(),r=e.element(t).height(),s=a.offset().top,c=o.height(),u=parseInt(i.top)||0,l=parseInt(i.bottom),d=!1;return isNaN(l)?isNaN(u)||(d=n>s+u+c,d&&o.css({bottom:"auto",top:u})):(d=n>s+c||s+l>n+r,d&&o.css({bottom:l,top:"auto"})),u+(l||0)+c>r&&(d=!1),d?o.addClass("stuck"):(o.css({bottom:"auto",top:"auto"}),o.removeClass("stuck")),!0}var a=e.element('<div class="sticky-anchor"></div>');o.before(a),o.css({bottom:"auto",top:"auto"});var c=r(s,200);e.element(t).on("scroll",c),n.$watch(i.reloadOnChange,c)}var i={link:o,restrict:"A"};return i}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnStoreInfo",["gsnApi","gsnStore","$interpolate",function(e,t,n){function r(r,o,i){function s(){var n=e.isNull(e.getSelectedStoreId(),0);n>0&&t.getStore().then(function(e){if(e){r.store=e;var t=a(r);o.html(t)}})}var a=n(i.gsnStoreInfo.replace(/\[+/gi,"{{").replace(/\]+/gi,"}}"));s(),r.$on("gsnevent:store-setid",s)}var o={restrict:"EA",scope:!0,link:r};return o}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnSvgImage",["$window","$timeout","debounce",function(t,n,r){function o(o,i,s){function a(){var g=e.element(t);return""==s.src?void n(a,200):void d(s.src,function(t,a){if(!t){i.html(""),i.append(a),u=a.width||a.naturalWidth||a.offsetWidth,l=a.height||a.naturalHeight||a.offsetHeight,a=e.element(s.gsnSvgImage),c=a.parent("svg"),c[0].setAttributeNS("","viewBox","0 0 "+u+" "+l),a.attr("width",u).attr("height",l).attr("xlink:href",s.src),a.show();var d=/Trident.*rv:11\.0/.test(navigator.userAgent)||/msie/gi.test(navigator.userAgent);if(d&&s.syncHeight){var p=r(function(){var t=i.parent().width(),n=t/(u||t||1),r=n*l;e.element(s.syncHeight).height(r)},200);p(),g.on("resize",p)}var f=r(function(){e.element(".onlist").click(),n(function(){o.vm.activeItem=null,o.vm.loadCount++},200)},200);f(),g.on("resize",f),g.on("orientationchange",f)}})}var c,u=(s.src,0),l=0,d=function(e,t){var n=new Image;n.src=e;n.onload=function(){t(null,n)},n.onerror=function(){t("ERROR LOADING IMAGE "+e,null)}},g=r(a,100);o.$watch(s.watch||"vm.page",g)}var i={link:o,restrict:"A"};return i}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnTextCapture",["$window","$timeout",function(e,t){function n(e,n,r){var o=parseInt(r.timeout),i=o>0;0>=o&&(o=200);var s=function(){e.$apply(r.gsnTextCapture+' = "'+n.text().replace(/"/g,'\\"').replace(/(ie8newlinehack)/g,"\r\n")+'"');var a=e.$eval(r.gsnTextCapture),c=a.replace(/\s+/gi,"").length<=0;return c?void t(s,o):void(i&&t(s,o))};t(s,o)}var r={link:n,restrict:"A"};return r}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnTwitterShare",["$timeout","gsnApi",function(t,n){function r(t,r,o){function i(){if("undefined"==typeof twttr){if(a)return;a=!0;var c="//platform.twitter.com/widgets.js";return void n.loadScripts([c],i)}if(!(r.html().length>10)){var u=t.$eval(o.gsnTwitterShare);e.extend(s,u),twttr.widgets.createShareButton(o.url,r[0],function(){},s)}}var s={count:"none"},a=!1;i()}var o={link:r,restrict:"A"};return o}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnTwitterTimeline",["$timeout","gsnApi",function(e,t){function n(e,n,r){function o(){if("undefined"==typeof twttr){if(i)return;i=!0;var e="//platform.twitter.com/widgets.js";return void t.loadScripts([e],o)}twttr.widgets.load()}var i=!1;n.html('<a class="twitter-timeline" href="'+r.href+'" data-widget-id="'+r.gsnTwitterTimeline+'">'+r.title+"</a>"),o()}var r={link:n,restrict:"A"};return r}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnValidUser",["$http","$timeout","gsnApi",function(e,t,n){function r(r,o,i,s){var a;o.blur(function(){var r=s.$viewValue;return n.isNull(r,"").length<=0?void s.$setValidity("gsnValidUser","required"!=n.isNull(i.gsnValidUser,"")):(a&&a.$$timeoutId&&t.cancel(a.$$timeoutId),s.$error.email?void s.$setValidity("gsnValidUser",!1):void(a=t(function(){n.getAccessToken().then(function(){var t=n.getProfileApiUrl()+"/HasUsername?username="+encodeURIComponent(r);e.get(t,{headers:n.getApiHeaders()}).success(function(e){a=null,s.$setValidity("gsnValidUser","true"!=e)}).error(function(){a=null})})},200)))})}var o={link:r,restrict:"A",require:"ngModel"};return o}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("gsnWatch",[function(){function t(t,n,r){var o=r.model;"undefined"==typeof o&&(o="{}"),t.model=t.$eval(o);var i=t.$eval(r.gsnWatch);e.forEach(i,function(e,n){t.$watch(e,function(e){t.model[n]=e})})}var n={restrict:"EA",scope:!0,link:t};return n}])}(angular),function(e){"use strict";var t=e.module("gsn.core"),n=function(n){var r=e.copy(n);return t.directive(r.name,[function(){return{restrict:"A",link:function(t,n,o){var i,s="$"+r.name,a=t[s];if(a&&(i=a.isEnabled,a.isEnabled=!1),t.hasOwnProperty(s))throw{name:"ScopeError",message:"Multiple copies of "+r.name+" modifier in same scope"};var c={isEnabled:!0};t[s]=c;var u=e.element(r.selector);if(u.length<=0&&"string"==typeof r.html){u=e.element(r.html);var l=e.element("head")[0];l.insertBefore(u[0],e.element("title")[0])}var d=r.get(u),g=d;o.$observe(r.name,function(e,t){c.isEnabled&&(g=e,r.set(u,e,t))}),t.$on("$destroy",function(){r.set(u,d,g),a&&(a.isEnabled=i)})}}}])};n({name:"gsnTitle",selector:"title",get:function(e){return e.text()},set:function(e,t){return e.text(t)}}),n({name:"gsnMetaViewport",selector:'meta[name="viewport"]',get:function(e){return e.attr("content")},set:function(e,t){return e.attr("content",t)}}),n({name:"gsnMetaAuthor",selector:'meta[name="author"]',get:function(e){return e.attr("content")},set:function(e,t){return e.attr("content",t)}}),n({name:"gsnMetaDescription",selector:'meta[name="description"]',get:function(e){return e.attr("content")},set:function(e,t){return e.attr("content",t)}}),n({name:"gsnMetaKeywords",selector:'meta[name="keywords"]',get:function(e){return e.attr("content")},set:function(e,t){return e.attr("content",t)}}),n({name:"gsnMetaGoogleSiteVerification",selector:'meta[name="google-site-verification"]',html:'<meta name="google-site-verification" content="" />',get:function(e){return e.attr("content")},set:function(e,t){return e.attr("content",t)}}),n({name:"gsnOgTitle",selector:'meta[name="og:title"]',html:'<meta name="og:title" content="" />',get:function(e){return e.attr("content")},set:function(e,t){return e.attr("content",t)}}),n({name:"gsnOgType",selector:'meta[name="og:type"]',html:'<meta name="og:type" content="" />',get:function(e){return e.attr("content")},set:function(e,t){return e.attr("content",t)}}),n({name:"gsnOgImage",selector:'meta[name="og:image"]',html:'<meta name="og:image" content="" />',get:function(e){return e.attr("content")},set:function(e,t){return e.attr("content",t)}}),n({name:"gsnOgUrl",selector:'meta[name="og:url"]',html:'<meta name="og:url" content="" />',get:function(e){return e.attr("content")},set:function(e,t){return e.attr("content",t)}}),n({name:"gsnOgDescription",selector:'meta[name="og:description"]',html:'<meta name="og:description" content="" />',get:function(e){return e.attr("content")},set:function(e,t){return e.attr("content",t)}})}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("ngGiveHead",[function(){function t(t,n,r){var o=e.element("<"+r.ngGiveHead+">");if(r.attributes){var i=t.$eval(r.attributes);e.forEach(i,function(e,t){o.attr(t,e)})}var s=e.element("head")[0];s.insertBefore(o[0],e.element("title")[0])}var n={restrict:"EA",link:t};return n}])}(angular),function(e){"use strict";var t=e.module("gsn.core");t.directive("placeholder",["$timeout","gsnApi",function(t,n){return function(r,o,i){var s,a,c,u,l={cssClass:"placeholder",excludedAttrs:["placeholder","name","id","ng-model","type"]},d=i.placeholder,g="password"===i.type,p="placeholder"in document.createElement("input")&&"placeholder"in document.createElement("textarea");if(!p){c=function(){var t={};return e.forEach(i.$attr,function(e,n){gsn.contains(l.excludedAttrs,n)||(t[n]=i[n])}),t};var f=function(){return e.element("<input>",e.extend(c(),{type:"text",value:d})).addClass(l.cssClass).bind("focus",function(){a()}).insertBefore(o)};g?(u=f(),s=function(){o.val()||(u.show(),o.hide())},a=function(){u.is(":visible")&&(u.hide(),o.show().focus())}):(s=function(){o.val()||(o.val(d),t(function(){o.addClass(l.cssClass)},0))},a=function(){o.hasClass(l.cssClass)&&(o.val("").select(),o.removeClass(l.cssClass))}),o.on("focus",a).on("blur",s),t(function(){o.trigger("blur")},0),r.$watch(i.ngModel,function(e){n.isNull(e).length<=0?o.is(":focus")||o.trigger("blur"):o.hasClass(l.cssClass)&&o.removeClass(l.cssClass)})}}}])}(angular),function(e,t){"use strict";var n,r={},o={sdk:!1,ready:!1};t.module("facebook",[]).value("settings",r).value("flags",o).provider("Facebook",[function(){r.appId=null,this.setAppId=function(e){r.appId=e},this.getAppId=function(){return r.appId},r.locale="en_US",this.setLocale=function(e){r.locale=e},this.getLocale=function(){return r.locale},r.status=!0,this.setStatus=function(e){r.status=e},this.getStatus=function(){return r.status},r.channelUrl=null,this.setChannel=function(e){r.channelUrl=e},this.getChannel=function(){return r.channelUrl},r.cookie=!0,this.setCookie=function(e){r.cookie=e},this.getCookie=function(){return r.cookie},r.xfbml=!0,this.setXfbml=function(e){r.xfbml=e},this.getXfbml=function(){return r.xfbml},r.authResponse=!0,this.setAuthResponse=function(e){r.authResponse=e||!0},this.getAuthResponse=function(){return r.authResponse},r.frictionlessRequests=!1,this.setFrictionlessRequests=function(e){r.frictionlessRequests=e},this.getFrictionlessRequests=function(){return r.frictionlessRequests},r.hideFlashCallback=null,this.setHideFlashCallback=function(e){r.hideFlashCallback=e||null},this.getHideFlashCallback=function(){return r.hideFlashCallback},this.setInitCustomOption=function(e,n){return t.isString(e)?(r[e]=n,r[e]):!1},this.getInitOption=function(e){return t.isString(e)&&r.hasOwnProperty(e)?r[e]:!1},r.loadSDK=!0,this.setLoadSDK=function(e){r.loadSDK=!!e},this.getLoadSDK=function(){return r.loadSDK},this.init=function(e,n){t.isString(e)&&(r.appId=e||r.appId),t.isObject(e)&&t.extend(r,e),t.isDefined(n)&&(r.loadSDK=!!n)},this.$get=["$q","$rootScope","$timeout","$window",function(e,i,s,a){function c(){this.appId=r.appId}return c.prototype.isReady=function(){return o.ready},t.forEach(["login","logout","api","ui","getLoginStatus"],function(r){c.prototype[r]=function(){var o,i,c=e.defer(),u=Array.prototype.slice.call(arguments);return t.forEach(u,function(e,n){t.isFunction(e)&&(o=e,i=n)}),t.isFunction(o)&&t.isNumber(i)&&u.splice(i,1,function(e){s(function(){t.isUndefined(e.error)?c.resolve(e):c.reject(e),t.isFunction(o)&&o(e)})}),s(function(){n.promise.then(function(){a.FB[r].apply(FB,u)},function(){throw"Facebook API could not be initialized properly"})}),c.promise}}),c.prototype.parseXFBML=function(){var t=e.defer();return s(function(){n.promise.then(function(){a.FB.parse(),t.resolve()},function(){throw"Facebook API could not be initialized properly"})}),t.promise},c.prototype.subscribe=function(){var r,o,i=e.defer(),c=Array.prototype.slice.call(arguments);return t.forEach(c,function(e,n){t.isFunction(e)&&(r=e,o=n)}),t.isFunction(r)&&t.isNumber(o)&&c.splice(o,1,function(e){s(function(){t.isUndefined(e.error)?i.resolve(e):i.reject(e),t.isFunction(r)&&r(e)})}),s(function(){n.promise.then(function(){a.FB.Event.subscribe.apply(FB,c)},function(){throw"Facebook API could not be initialized properly"})}),i.promise},c.prototype.unsubscribe=function(){var r,o,i=e.defer(),c=Array.prototype.slice.call(arguments);return t.forEach(c,function(e,n){t.isFunction(e)&&(r=e,o=n)}),t.isFunction(r)&&t.isNumber(o)&&c.splice(o,1,function(e){s(function(){t.isUndefined(e.error)?i.resolve(e):i.reject(e),t.isFunction(r)&&r(e)})}),s(function(){n.promise.then(function(){a.FB.Event.unsubscribe.apply(FB,c)},function(){throw"Facebook API could not be initialized properly"})}),i.promise},new c}]}]).run(["$rootScope","$q","$window","$timeout",function(e,i,s,a){n=i.defer();var c=r.loadSDK;delete r.loadSDK,s.fbAsyncInit=function(){a(function(){if(!r.appId)throw"Missing appId setting.";FB.init(r),o.ready=!0,t.forEach({"auth.login":"login","auth.logout":"logout","auth.prompt":"prompt","auth.sessionChange":"sessionChange","auth.statusChange":"statusChange","auth.authResponseChange":"authResponseChange","xfbml.render":"xfbmlRender","edge.create":"like","edge.remove":"unlike","comment.create":"comment","comment.remove":"uncomment"},function(t,n){FB.Event.subscribe(n,function(n){a(function(){e.$broadcast("Facebook:"+t,n)})})}),e.$broadcast("Facebook:load"),n.resolve(FB)})},function(){var e=document.getElementById("fb-root");return e||(e=document.createElement("div"),e.id="fb-root",document.body.insertBefore(e,document.body.childNodes[0])),e}(),c&&!function(){var e="//connect.facebook.net/"+r.locale+"/all.js",t=document.createElement("script");t.id="facebook-jssdk",t.async=!0,"file"===s.location.protocol&&(e="https:"+e),t.src=e,t.onload=function(){o.sdk=!0},document.getElementsByTagName("head")[0].appendChild(t)}()}])}(window,angular),!function(e){"use strict";var t=window.angulartics||(window.angulartics={});t.waitForVendorCount=0,t.waitForVendorApi=function(e,n,r,o,i){i||t.waitForVendorCount++,o||(o=r,r=void 0),!Object.prototype.hasOwnProperty.call(window,e)||void 0!==r&&void 0===window[e][r]?setTimeout(function(){t.waitForVendorApi(e,n,r,o,!0)},n):(t.waitForVendorCount--,o(window[e]))},e.module("angulartics",[]).provider("$analytics",function(){var n={pageTracking:{autoTrackFirstPage:!0,autoTrackVirtualPages:!0,trackRelativePath:!1,autoBasePath:!1,basePath:""},eventTracking:{},bufferFlushDelay:1e3,developerMode:!1},r=["pageTrack","eventTrack","setAlias","setUsername","setUserProperties","setUserPropertiesOnce","setSuperProperties","setSuperPropertiesOnce"],o={},i={},s=function(e){return function(){t.waitForVendorCount&&(o[e]||(o[e]=[]),o[e].push(arguments))}},a=function(t,n){return i[t]||(i[t]=[]),i[t].push(n),function(){var n=arguments;e.forEach(i[t],function(e){e.apply(this,n)},this)}},c={settings:n},u=function(e,t){t?setTimeout(e,t):e()},l={$get:function(){return c},api:c,settings:n,virtualPageviews:function(e){this.settings.pageTracking.autoTrackVirtualPages=e},firstPageview:function(e){this.settings.pageTracking.autoTrackFirstPage=e},withBase:function(t){this.settings.pageTracking.basePath=t?e.element(document).find("base").attr("href"):""},withAutoBase:function(e){this.settings.pageTracking.autoBasePath=e},developerMode:function(e){this.settings.developerMode=e}},d=function(t,r){c[t]=a(t,r);var i=n[t],s=i?i.bufferFlushDelay:null,l=null!==s?s:n.bufferFlushDelay;e.forEach(o[t],function(e,t){u(function(){r.apply(this,e)},t*l)})},g=function(e){return e.replace(/^./,function(e){return e.toUpperCase()})},p=function(e){var t="register"+g(e);l[t]=function(t){d(e,t)},c[e]=a(e,s(e))};return e.forEach(r,p),l}).run(["$rootScope","$window","$analytics","$injector",function(t,n,r,o){r.settings.pageTracking.autoTrackFirstPage&&o.invoke(["$location",function(e){var t=!0;if(o.has("$route")){var i=o.get("$route");for(var s in i.routes){t=!1;break}}else if(o.has("$state")){var a=o.get("$state");for(var c in a.get()){t=!1;break}}if(t)if(r.settings.pageTracking.autoBasePath&&(r.settings.pageTracking.basePath=n.location.pathname),r.settings.pageTracking.trackRelativePath){var u=r.settings.pageTracking.basePath+e.url();r.pageTrack(u,e)}else r.pageTrack(e.absUrl(),e)}]),r.settings.pageTracking.autoTrackVirtualPages&&o.invoke(["$location",function(e){r.settings.pageTracking.autoBasePath&&(r.settings.pageTracking.basePath=n.location.pathname+"#"),o.has("$route")&&t.$on("$routeChangeSuccess",function(t,n){if(!n||!(n.$$route||n).redirectTo){var o=r.settings.pageTracking.basePath+e.url();r.pageTrack(o,e)}}),o.has("$state")&&t.$on("$stateChangeSuccess",function(){var t=r.settings.pageTracking.basePath+e.url();r.pageTrack(t,e)})}]),r.settings.developerMode&&e.forEach(r,function(e,t){"function"==typeof e&&(r[t]=function(){})})}]).directive("analyticsOn",["$analytics",function(t){function n(e){return["a:","button:","button:button","button:submit","input:button","input:submit"].indexOf(e.tagName.toLowerCase()+":"+(e.type||""))>=0
}function r(e){return n(e),"click"}function o(e){return n(e)?e.innerText||e.value:e.id||e.name||e.tagName}function i(e){return"analytics"===e.substr(0,9)&&-1===["On","Event","If","Properties","EventType"].indexOf(e.substr(9))}function s(e){var t=e.slice(9);return"undefined"!=typeof t&&null!==t&&t.length>0?t.substring(0,1).toLowerCase()+t.substring(1):t}return{restrict:"A",link:function(n,a,c){var u=c.analyticsOn||r(a[0]),l={};e.forEach(c.$attr,function(e,t){i(t)&&(l[s(t)]=c[t],c.$observe(t,function(e){l[s(t)]=e}))}),e.element(a[0]).bind(u,function(r){var i=c.analyticsEvent||o(a[0]);l.eventType=r.type,(!c.analyticsIf||n.$eval(c.analyticsIf))&&(c.analyticsProperties&&e.extend(l,n.$eval(c.analyticsProperties)),t.eventTrack(i,l))})}}}])}(angular),!function(e){"use strict";e.module("angulartics").config(["$analyticsProvider",function(e){e.registerPageTrack(function(e){var t=window.dataLayer=window.dataLayer||[];t.push({event:"content-view","content-name":e})}),e.registerEventTrack(function(e,t){var n=window.dataLayer=window.dataLayer||[];n.push({event:"interaction",target:t.category,action:e,"target-properties":t.label,value:t.value,"interaction-type":t.noninteraction})})}])}(angular),function(e){"use strict";e.module("angulartics").config(["$analyticsProvider","$documentProvider",function(t,n){function r(e){c=e,c&&(t.registerPageTrack(o),t.registerEventTrack(i))}function o(e,t){var n=t.title||u[0].title,r=s(t.type);c.log(e,n,r)}function i(t,n){var r,o,i,u,l;if(e.isDefined(n.goal))r=n.goal,o=a(n.revenue)?n.revenue:void 0,i=!!n.noQueue,c.goal(r,o,i);else{l=s(n.type)===n.type?n.type:"click",u=n.title||n.value;var d="";n.category&&(d+="&ec="+n.category),n.label&&(d+="&el="+n.label),d&&(t="/evt/"+t+d.replace("&","?")),c.log(t,u,l)}}function s(e){var t=["click","download","outbound","pageview"];return t.indexOf(e)>=0?e:"pageview"}function a(e){return"number"==typeof e&&isFinite(e)}var c,u=n.$get;t.settings.pageTracking.trackRelativePath=!0,angulartics.waitForVendorApi("clicky",100,r)}])}(angular),function(){"use strict";function e(t,r){function o(e,t){return function(){return e.apply(t,arguments)}}var i;if(r=r||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=r.touchBoundary||10,this.layer=t,this.tapDelay=r.tapDelay||200,this.tapTimeout=r.tapTimeout||700,!e.notNeeded(t)){for(var s=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],a=this,c=0,u=s.length;u>c;c++)a[s[c]]=o(a[s[c]],a);n&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,n,r){var o=Node.prototype.removeEventListener;"click"===e?o.call(t,e,n.hijacked||n,r):o.call(t,e,n,r)},t.addEventListener=function(e,n,r){var o=Node.prototype.addEventListener;"click"===e?o.call(t,e,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),r):o.call(t,e,n,r)}),"function"==typeof t.onclick&&(i=t.onclick,t.addEventListener("click",function(e){i(e)},!1),t.onclick=null)}}var t=navigator.userAgent.indexOf("Windows Phone")>=0,n=navigator.userAgent.indexOf("Android")>0&&!t,r=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,o=r&&/OS 4_\d(_\d)?/.test(navigator.userAgent),i=r&&/OS [6-7]_\d/.test(navigator.userAgent),s=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(r&&"file"===e.type||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!n;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var n,r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),r=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},e.prototype.determineEventType=function(e){return n&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},e.prototype.focus=function(e){var t;r&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type&&"month"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,n;if(t=e.fastClickScrollParent,!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,n,i;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0],r){if(i=window.getSelection(),i.rangeCount&&!i.isCollapsed)return!0;if(!o){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1},e.prototype.onTouchMove=function(e){return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},e.prototype.findControl=function(e){return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var t,s,a,c,u,l=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,s=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,i&&(u=e.changedTouches[0],l=document.elementFromPoint(u.pageX-window.pageXOffset,u.pageY-window.pageYOffset)||l,l.fastClickScrollParent=this.targetElement.fastClickScrollParent),a=l.tagName.toLowerCase(),"label"===a){if(t=this.findControl(l)){if(this.focus(l),n)return!1;l=t}}else if(this.needsFocus(l))return e.timeStamp-s>100||r&&window.top!==window&&"input"===a?(this.targetElement=null,!1):(this.focus(l),this.sendClick(l,e),r&&"select"===a||(this.targetElement=null,e.preventDefault()),!1);return r&&!o&&(c=l.fastClickScrollParent,c&&c.fastClickLastScrollTop!==c.scrollTop)?!0:(this.needsClick(l)||(e.preventDefault(),this.sendClick(l,e)),!1)},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0},e.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;n&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var t,r,o,i;if("undefined"==typeof window.ontouchstart)return!0;if(r=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!n)return!0;if(t=document.querySelector("meta[name=viewport]")){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(r>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(s&&(o=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/),o[1]>=10&&o[2]>=3&&(t=document.querySelector("meta[name=viewport]")))){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===e.style.msTouchAction||"manipulation"===e.style.touchAction?!0:(i=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1],i>=27&&(t=document.querySelector("meta[name=viewport]"),t&&(-1!==t.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))?!0:"none"===e.style.touchAction||"manipulation"===e.style.touchAction?!0:!1)},e.attach=function(t,n){return new e(t,n)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e}(),function(){"use strict";angular.module("angular-loading-bar",["chieffancypants.loadingBar"]),angular.module("chieffancypants.loadingBar",[]).config(["$httpProvider",function(e){var t=["$q","$cacheFactory","$timeout","$rootScope","cfpLoadingBar",function(t,n,r,o,i){function s(){r.cancel(c),i.complete(),l=0,u=0}function a(t){var r,o=e.defaults;if("GET"!==t.method||t.cache===!1)return t.cached=!1,!1;r=t.cache===!0&&void 0===o.cache?n.get("$http"):void 0!==o.cache?o.cache:t.cache;var i=void 0!==r?void 0!==r.get(t.url):!1;return void 0!==t.cached&&i!==t.cached?t.cached:(t.cached=i,i)}var c,u=0,l=0,d=i.latencyThreshold;return{request:function(e){return e.ignoreLoadingBar||a(e)||(o.$broadcast("cfpLoadingBar:loading",{url:e.url}),0===u&&(c=r(function(){i.start()},d)),u++,i.set(l/u)),e},response:function(e){return a(e.config)||(l++,o.$broadcast("cfpLoadingBar:loaded",{url:e.config.url}),l>=u?s():i.set(l/u)),e},responseError:function(e){return a(e.config)||(l++,o.$broadcast("cfpLoadingBar:loaded",{url:e.config.url}),l>=u?s():i.set(l/u)),t.reject(e)}}}];e.interceptors.push(t)}]).provider("cfpLoadingBar",function(){this.includeSpinner=!0,this.includeBar=!0,this.latencyThreshold=100,this.parentSelector="body",this.$get=["$document","$timeout","$animate","$rootScope",function(e,t,n,r){function o(){t.cancel(l),m||(r.$broadcast("cfpLoadingBar:started"),m=!0,I&&n.enter(p,g),y&&n.enter(h,g),i(.02))}function i(e){if(m){var n=100*e+"%";f.css("width",n),v=e,t.cancel(u),u=t(function(){s()},250)}}function s(){if(!(a()>=1)){var e=0,t=a();e=t>=0&&.25>t?(3*Math.random()+3)/100:t>=.25&&.65>t?3*Math.random()/100:t>=.65&&.9>t?2*Math.random()/100:t>=.9&&.99>t?.005:0;var n=a()+e;i(n)}}function a(){return v}function c(){r.$broadcast("cfpLoadingBar:completed"),i(1),l=t(function(){n.leave(p,function(){v=0,m=!1}),n.leave(h)},500)}var u,l,d=this.parentSelector,g=e.find(d),p=angular.element('<div id="loading-bar"><div class="bar"><div class="peg"></div></div></div>'),f=p.find("div").eq(0),h=angular.element('<div id="loading-bar-spinner"><img src="//cdn.gsngrocers.com/script/images/loading.gif" alt="loading spinner" class="spinner-icon" /></div>'),m=!1,v=0,y=this.includeSpinner,I=this.includeBar;return{start:o,set:i,status:a,inc:s,complete:c,includeSpinner:this.includeSpinner,latencyThreshold:this.latencyThreshold,parentSelector:this.parentSelector}}]})}();var mod;mod=angular.module("infinite-scroll",[]),mod.directive("infiniteScroll",["$rootScope","$window","$timeout",function(e,t,n){return{link:function(r,o,i){var s,a,c,u;return t=angular.element(t),c=0,null!=i.infiniteScrollDistance&&r.$watch(i.infiniteScrollDistance,function(e){return c=parseInt(e,10)}),u=!0,s=!1,null!=i.infiniteScrollDisabled&&r.$watch(i.infiniteScrollDisabled,function(e){return u=!e,u&&s?(s=!1,a()):void 0}),a=function(){var n,a,l,d;return d=t.height()+t.scrollTop(),n=o.offset().top+o.height(),a=n-d,l=t.height()*c>=a,l&&u?e.$$phase?r.$eval(i.infiniteScroll):r.$apply(i.infiniteScroll):l?s=!0:void 0},t.on("scroll",a),r.$on("$destroy",function(){return t.off("scroll",a)}),n(function(){return i.infiniteScrollImmediateCheck?r.$eval(i.infiniteScrollImmediateCheck)?a():void 0:a()},0)}}}]),angular.module("ui.alias",[]).config(["$compileProvider","uiAliasConfig",function(e,t){t=t||{},angular.forEach(t,function(t,n){angular.isString(t)&&(t={replace:!0,template:t}),e.directive(n,function(){return t})})}]),angular.module("ui.event",[]).directive("uiEvent",["$parse",function(e){return function(t,n,r){var o=t.$eval(r.uiEvent);angular.forEach(o,function(r,o){var i=e(r);n.bind(o,function(e){var n=Array.prototype.slice.call(arguments);n=n.splice(1),i(t,{$event:e,$params:n}),t.$$phase||t.$apply()})})}}]),angular.module("ui.format",[]).filter("format",function(){return function(e,t){var n=e;if(angular.isString(n)&&void 0!==t)if(angular.isArray(t)||angular.isObject(t)||(t=[t]),angular.isArray(t)){var r=t.length,o=function(e,n){return n=parseInt(n,10),n>=0&&r>n?t[n]:e};n=n.replace(/\$([0-9]+)/g,o)}else angular.forEach(t,function(e,t){n=n.split(":"+t).join(e)});return n}}),angular.module("ui.highlight",[]).filter("highlight",function(){return function(e,t,n){return t||angular.isNumber(t)?(e=e.toString(),t=t.toString(),n?e.split(t).join('<span class="ui-match">'+t+"</span>"):e.replace(new RegExp(t,"gi"),'<span class="ui-match">$&</span>')):e}}),angular.module("ui.include",[]).directive("uiInclude",["$http","$templateCache","$anchorScroll","$compile",function(e,t,n,r){return{restrict:"ECA",terminal:!0,compile:function(o,i){var s=i.uiInclude||i.src,a=i.fragment||"",c=i.onload||"",u=i.autoscroll;return function(o,i){function l(){var l=++g,f=o.$eval(s),h=o.$eval(a);f?e.get(f,{cache:t}).success(function(e){if(l===g){d&&d.$destroy(),d=o.$new();var t;t=h?angular.element("<div/>").html(e).find(h):angular.element("<div/>").html(e).contents(),i.html(t),r(t)(d),!angular.isDefined(u)||u&&!o.$eval(u)||n(),d.$emit("$includeContentLoaded"),o.$eval(c)}}).error(function(){l===g&&p()}):p()}var d,g=0,p=function(){d&&(d.$destroy(),d=null),i.html("")};o.$watch(a,l),o.$watch(s,l)}}}}]),angular.module("ui.indeterminate",[]).directive("uiIndeterminate",[function(){return{compile:function(e,t){return t.type&&"checkbox"===t.type.toLowerCase()?function(e,t,n){e.$watch(n.uiIndeterminate,function(e){t[0].indeterminate=!!e})}:angular.noop}}}]),angular.module("ui.inflector",[]).filter("inflector",function(){function e(e){return e.replace(/^([a-z])|\s+([a-z])/g,function(e){return e.toUpperCase()})}function t(e,t){return e.replace(/[A-Z]/g,function(e){return t+e})}var n={humanize:function(n){return e(t(n," ").split("_").join(" "))},underscore:function(e){return e.substr(0,1).toLowerCase()+t(e.substr(1),"_").toLowerCase().split(" ").join("_")},variable:function(t){return t=t.substr(0,1).toLowerCase()+e(t.split("_").join(" ")).substr(1).split(" ").join("")}};return function(e,t){return t!==!1&&angular.isString(e)?(t=t||"humanize",n[t](e)):e}}),angular.module("ui.jq",[]).value("uiJqConfig",{}).directive("uiJq",["uiJqConfig","$timeout",function(e,t){return{restrict:"A",compile:function(n,r){if(!angular.isFunction(n[r.uiJq]))throw new Error('ui-jq: The "'+r.uiJq+'" function does not exist');var o=e&&e[r.uiJq];return function(e,n,r){function i(){t(function(){n[r.uiJq].apply(n,s)},0,!1)}var s=[];r.uiOptions?(s=e.$eval("["+r.uiOptions+"]"),angular.isObject(o)&&angular.isObject(s[0])&&(s[0]=angular.extend({},o,s[0]))):o&&(s=[o]),r.ngModel&&n.is("select,input,textarea")&&n.bind("change",function(){n.trigger("input")}),r.uiRefresh&&e.$watch(r.uiRefresh,function(){i()}),i()}}}}]),angular.module("ui.keypress",[]).factory("keypressHelper",["$parse",function(e){var t={8:"backspace",9:"tab",13:"enter",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete"},n=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};return function(r,o,i,s){var a,c=[];a=o.$eval(s["ui"+n(r)]),angular.forEach(a,function(t,n){var r,o;o=e(t),angular.forEach(n.split(" "),function(e){r={expression:o,keys:{}},angular.forEach(e.split("-"),function(e){r.keys[e]=!0}),c.push(r)})}),i.bind(r,function(e){var n=!(!e.metaKey||e.ctrlKey),i=!!e.altKey,s=!!e.ctrlKey,a=!!e.shiftKey,u=e.keyCode;"keypress"===r&&!a&&u>=97&&122>=u&&(u-=32),angular.forEach(c,function(r){var c=r.keys[t[u]]||r.keys[u.toString()],l=!!r.keys.meta,d=!!r.keys.alt,g=!!r.keys.ctrl,p=!!r.keys.shift;c&&l===n&&d===i&&g===s&&p===a&&o.$apply(function(){r.expression(o,{$event:e})})})})}}]),angular.module("ui.keypress").directive("uiKeydown",["keypressHelper",function(e){return{link:function(t,n,r){e("keydown",t,n,r)}}}]),angular.module("ui.keypress").directive("uiKeypress",["keypressHelper",function(e){return{link:function(t,n,r){e("keypress",t,n,r)}}}]),angular.module("ui.keypress").directive("uiKeyup",["keypressHelper",function(e){return{link:function(t,n,r){e("keyup",t,n,r)}}}]),angular.module("ui.mask",[]).value("uiMaskConfig",{maskDefinitions:{9:/\d/,A:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/}}).directive("uiMask",["uiMaskConfig",function(e){return{priority:100,require:"ngModel",restrict:"A",compile:function(){var t=e;return function(e,n,r,o){function i(e){return angular.isDefined(e)?(y(e),B?(l(),d(),!0):u()):u()}function s(e){angular.isDefined(e)&&(L=e,B&&b())}function a(e){return B?(U=f(e||""),D=p(U),o.$setValidity("mask",D),D&&U.length?h(U):void 0):e}function c(e){return B?(U=f(e||""),D=p(U),o.$viewValue=U.length?h(U):"",o.$setValidity("mask",D),""===U&&void 0!==o.$error.required&&o.$setValidity("required",!1),D?U:void 0):e}function u(){return B=!1,g(),angular.isDefined(V)?n.attr("placeholder",V):n.removeAttr("placeholder"),angular.isDefined(H)?n.attr("maxlength",H):n.removeAttr("maxlength"),n.val(o.$modelValue),o.$viewValue=o.$modelValue,!1}function l(){U=F=f(o.$modelValue||""),x=R=h(U),D=p(U);var e=D&&U.length?x:"";r.maxlength&&n.attr("maxlength",2*A[A.length-1]),n.attr("placeholder",L),n.val(e),o.$viewValue=e}function d(){_||(n.bind("blur",I),n.bind("mousedown mouseup",S),n.bind("input keyup click focus",b),_=!0)}function g(){_&&(n.unbind("blur",I),n.unbind("mousedown",S),n.unbind("mouseup",S),n.unbind("input",b),n.unbind("keyup",b),n.unbind("click",b),n.unbind("focus",b),_=!1)}function p(e){return e.length?e.length>=E:!0}function f(e){var t="",n=T.slice();return e=e.toString(),angular.forEach(N,function(t){e=e.replace(t,"")}),angular.forEach(e.split(""),function(e){n.length&&n[0].test(e)&&(t+=e,n.shift())}),t}function h(e){var t="",n=A.slice();return angular.forEach(L.split(""),function(r,o){e.length&&o===n[0]?(t+=e.charAt(0)||"_",e=e.substr(1),n.shift()):t+=r}),t}function m(e){var t=r.placeholder;return"undefined"!=typeof t&&t[e]?t[e]:"_"}function v(){return L.replace(/[_]+/g,"_").replace(/([^_]+)([a-zA-Z0-9])([^_])/g,"$1$2_$3").split("_")}function y(e){var t=0;if(A=[],T=[],L="","string"==typeof e){E=0;var n=!1,r=e.split("");angular.forEach(r,function(e,r){j.maskDefinitions[e]?(A.push(t),L+=m(r),T.push(j.maskDefinitions[e]),t++,n||E++):"?"===e?n=!0:(L+=e,t++)})}A.push(A.slice().pop()+1),N=v(),B=A.length>1?!0:!1}function I(){O=0,M=0,D&&0!==U.length||(x="",n.val(""),e.$apply(function(){o.$setViewValue("")}))}function S(e){"mousedown"===e.type?n.bind("mouseout",C):n.unbind("mouseout",C)}function C(){M=P(this),n.unbind("mouseout",C)}function b(t){t=t||{};var r=t.which,i=t.type;if(16!==r&&91!==r){var s,a=n.val(),c=R,u=f(a),l=F,d=!1,g=k(this)||0,p=O||0,m=g-p,v=A[0],y=A[u.length]||A.slice().shift(),I=M||0,S=P(this)>0,C=I>0,b=a.length>c.length||I&&a.length>c.length-I,T=a.length<c.length||I&&a.length===c.length-I,L=r>=37&&40>=r&&t.shiftKey,N=37===r,E=8===r||"keyup"!==i&&T&&-1===m,U=46===r||"keyup"!==i&&T&&0===m&&!C,x=(N||E||"click"===i)&&g>v;if(M=P(this),!L&&(!S||"click"!==i&&"keyup"!==i)){if("input"===i&&T&&!C&&u===l){for(;E&&g>v&&!$(g);)g--;for(;U&&y>g&&-1===A.indexOf(g);)g++;var D=A.indexOf(g);u=u.substring(0,D)+u.substring(D+1),d=!0}for(s=h(u),R=s,F=u,n.val(s),d&&e.$apply(function(){o.$setViewValue(u)}),b&&v>=g&&(g=v+1),x&&g--,g=g>y?y:v>g?v:g;!$(g)&&g>v&&y>g;)g+=x?-1:1;(x&&y>g||b&&!$(p))&&g++,O=g,w(this,g)}}}function $(e){return A.indexOf(e)>-1}function k(e){if(!e)return 0;if(void 0!==e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();return t.moveStart("character",-e.value.length),t.text.length}return 0}function w(e,t){if(!e)return 0;if(0!==e.offsetWidth&&0!==e.offsetHeight)if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}}function P(e){return e?void 0!==e.selectionStart?e.selectionEnd-e.selectionStart:document.selection?document.selection.createRange().text.length:0:0}var A,T,L,N,E,U,x,D,R,F,O,M,B=!1,_=!1,V=r.placeholder,H=r.maxlength,j={};r.uiOptions?(j=e.$eval("["+r.uiOptions+"]"),angular.isObject(j[0])&&(j=function(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]?angular.extend(t[n],e[n]):t[n]=angular.copy(e[n]));return t}(t,j[0]))):j=t,r.$observe("uiMask",i),r.$observe("placeholder",s),o.$formatters.push(a),o.$parsers.push(c),n.bind("mousedown mouseup",S),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&(r=Number(arguments[1]),r!==r?r=0:0!==r&&1/0!==r&&r!==-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var o=r>=0?r:Math.max(n-Math.abs(r),0);n>o;o++)if(o in t&&t[o]===e)return o;return-1})}}}}]),angular.module("ui.reset",[]).value("uiResetConfig",null).directive("uiReset",["uiResetConfig",function(e){var t=null;return void 0!==e&&(t=e),{require:"ngModel",link:function(e,n,r,o){var i;i=angular.element('<a class="ui-reset" />'),n.wrap('<span class="ui-resetwrap" />').after(i),i.bind("click",function(n){n.preventDefault(),e.$apply(function(){o.$setViewValue(r.uiReset?e.$eval(r.uiReset):t),o.$render()})})}}}]),angular.module("ui.route",[]).directive("uiRoute",["$location","$parse",function(e,t){return{restrict:"AC",scope:!0,compile:function(n,r){var o;if(r.uiRoute)o="uiRoute";else if(r.ngHref)o="ngHref";else{if(!r.href)throw new Error("uiRoute missing a route or href property on "+n[0]);o="href"}return function(n,r,i){function s(t){var r=t.indexOf("#");r>-1&&(t=t.substr(r+1)),(u=function(){c(n,e.path().indexOf(t)>-1)})()}function a(t){var r=t.indexOf("#");r>-1&&(t=t.substr(r+1)),(u=function(){var r=new RegExp("^"+t+"$",["i"]);c(n,r.test(e.path()))})()}var c=t(i.ngModel||i.routeModel||"$uiRoute").assign,u=angular.noop;switch(o){case"uiRoute":i.uiRoute?a(i.uiRoute):i.$observe("uiRoute",a);break;case"ngHref":i.ngHref?s(i.ngHref):i.$observe("ngHref",s);break;case"href":s(i.href)}n.$on("$routeChangeSuccess",function(){u()}),n.$on("$stateChangeSuccess",function(){u()})}}}}]),angular.module("ui.scroll.jqlite",["ui.scroll"]).service("jqLiteExtras",["$log","$window",function(e,t){return{registerFor:function(e){var n,r,o,i,s,a,c;return r=angular.element.prototype.css,e.prototype.css=function(e,t){var n,o;return o=this,n=o[0],n&&3!==n.nodeType&&8!==n.nodeType&&n.style?r.call(o,e,t):void 0},a=function(e){return e&&e.document&&e.location&&e.alert&&e.setInterval},c=function(e,t,n){var r,o,i,s,c;return r=e[0],c={top:["scrollTop","pageYOffset","scrollLeft"],left:["scrollLeft","pageXOffset","scrollTop"]}[t],o=c[0],s=c[1],i=c[2],a(r)?angular.isDefined(n)?r.scrollTo(e[i].call(e),n):s in r?r[s]:r.document.documentElement[o]:angular.isDefined(n)?r[o]=n:r[o]},t.getComputedStyle?(i=function(e){return t.getComputedStyle(e,null)},n=function(e,t){return parseFloat(t)}):(i=function(e){return e.currentStyle},n=function(e,t){var n,r,o,i,s,a,c;return n=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,i=new RegExp("^("+n+")(?!px)[a-z%]+$","i"),i.test(t)?(c=e.style,r=c.left,s=e.runtimeStyle,a=s&&s.left,s&&(s.left=c.left),c.left=t,o=c.pixelLeft,c.left=r,a&&(s.left=a),o):parseFloat(t)}),o=function(e,t){var r,o,s,c,u,l,d,g,p,f,h,m,v;return a(e)?(r=document.documentElement[{height:"clientHeight",width:"clientWidth"}[t]],{base:r,padding:0,border:0,margin:0}):(v={width:[e.offsetWidth,"Left","Right"],height:[e.offsetHeight,"Top","Bottom"]}[t],r=v[0],d=v[1],g=v[2],l=i(e),h=n(e,l["padding"+d])||0,m=n(e,l["padding"+g])||0,o=n(e,l["border"+d+"Width"])||0,s=n(e,l["border"+g+"Width"])||0,c=l["margin"+d],u=l["margin"+g],p=n(e,c)||0,f=n(e,u)||0,{base:r,padding:h+m,border:o+s,margin:p+f})},s=function(e,t,n){var r,s,a;return s=o(e,t),s.base>0?{base:s.base-s.padding-s.border,outer:s.base,outerfull:s.base+s.margin}[n]:(r=i(e),a=r[t],(0>a||null===a)&&(a=e.style[t]||0),a=parseFloat(a)||0,{base:a-s.padding-s.border,outer:a,outerfull:a+s.padding+s.border+s.margin}[n])},angular.forEach({before:function(e){var t,n,r,o,i,s,a;if(i=this,n=i[0],o=i.parent(),t=o.contents(),t[0]===n)return o.prepend(e);for(r=s=1,a=t.length-1;a>=1?a>=s:s>=a;r=a>=1?++s:--s)if(t[r]===n)return void angular.element(t[r-1]).after(e);throw new Error("invalid DOM structure "+n.outerHTML)},height:function(e){var t;return t=this,angular.isDefined(e)?(angular.isNumber(e)&&(e+="px"),r.call(t,"height",e)):s(this[0],"height","base")},outerHeight:function(e){return s(this[0],"height",e?"outerfull":"outer")},offset:function(e){var t,n,r,o,i,s;return i=this,arguments.length?void 0===e?i:e:(t={top:0,left:0},o=i[0],(n=o&&o.ownerDocument)?(r=n.documentElement,o.getBoundingClientRect&&(t=o.getBoundingClientRect()),s=n.defaultView||n.parentWindow,{top:t.top+(s.pageYOffset||r.scrollTop)-(r.clientTop||0),left:t.left+(s.pageXOffset||r.scrollLeft)-(r.clientLeft||0)}):void 0)},scrollTop:function(e){return c(this,"top",e)},scrollLeft:function(e){return c(this,"left",e)}},function(t,n){return e.prototype[n]?void 0:e.prototype[n]=t})}}}]).run(["$log","$window","jqLiteExtras",function(e,t,n){return t.jQuery?void 0:n.registerFor(angular.element)}]),angular.module("ui.scroll",[]).directive("ngScrollViewport",["$log",function(){return{controller:["$scope","$element",function(e,t){return t}]}}]).directive("ngScroll",["$log","$injector","$rootScope","$timeout",function(e,t,n,r){return{require:["?^ngScrollViewport"],transclude:"element",priority:1e3,terminal:!0,compile:function(o,i,s){return function(i,a,c,u){var l,d,g,p,f,h,m,v,y,I,S,C,b,$,k,w,P,A,T,L,N,E,U,x,D,R,F,O,M,B,_,V,H,j,q,G;if(x=c.ngScroll.match(/^\s*(\w+)\s+in\s+(\w+)\s*$/),!x)throw new Error('Expected ngScroll in form of "item_ in _datasource_" but got "'+c.ngScroll+'"');if(E=x[1],C=x[2],L=function(e){return angular.isObject(e)&&e.get&&angular.isFunction(e.get)},S=i[C],!L(S)&&(S=t.get(C),!L(S)))throw new Error(C+" is not a valid datasource");return v=Math.max(3,+c.bufferSize||10),m=function(){return G.height()*Math.max(.1,+c.padding||.1)},_=function(e){return e[0].scrollHeight||e[0].document.documentElement.scrollHeight},l=null,s(j=i.$new(),function(e){var t,n,r,i,s,a;if(i=e[0].localName,"dl"===i)throw new Error("ng-scroll directive does not support <"+e[0].localName+"> as a repeating tag: "+e[0].outerHTML);return"li"!==i&&"tr"!==i&&(i="div"),a=u[0]||angular.element(window),a.css({"overflow-y":"auto",display:"block"}),r=function(e){var t,n,r;switch(e){case"tr":return r=angular.element("<table><tr><td><div></div></td></tr></table>"),t=r.find("div"),n=r.find("tr"),n.paddingHeight=function(){return t.height.apply(t,arguments)},n;default:return n=angular.element("<"+e+"></"+e+">"),n.paddingHeight=n.height,n}},n=function(e,t,n){return t[{top:"before",bottom:"after"}[n]](e),{paddingHeight:function(){return e.paddingHeight.apply(e,arguments)},insert:function(t){return e[{top:"after",bottom:"before"}[n]](t)}}},s=n(r(i),o,"top"),t=n(r(i),o,"bottom"),j.$destroy(),l={viewport:a,topPadding:s.paddingHeight,bottomPadding:t.paddingHeight,append:t.insert,prepend:s.insert,bottomDataPos:function(){return _(a)-t.paddingHeight()},topDataPos:function(){return s.paddingHeight()}}}),G=l.viewport,A=1,D=1,h=[],R=[],$=!1,p=!1,U=S.loading||function(){},N=!1,O=function(e,t){var n,r;for(n=r=e;t>=e?t>r:r>t;n=t>=e?++r:--r)h[n].scope.$destroy(),h[n].element.remove();return h.splice(e,t-e)},F=function(){return A=1,D=1,O(0,h.length),l.topPadding(0),l.bottomPadding(0),R=[],$=!1,p=!1,d(!1)},f=function(){return G.scrollTop()+G.height()},q=function(){return G.scrollTop()},V=function(){return!$&&l.bottomDataPos()<f()+m()},y=function(){var t,n,r,o,i,s;for(t=0,o=0,n=i=s=h.length-1;(0>=s?0>=i:i>=0)&&(r=h[n].element.outerHeight(!0),l.bottomDataPos()-t-r>f()+m());n=0>=s?++i:--i)t+=r,o++,$=!1;return o>0?(l.bottomPadding(l.bottomPadding()+t),O(h.length-o,h.length),D-=o,e.log("clipped off bottom "+o+" bottom padding "+l.bottomPadding())):void 0},H=function(){return!p&&l.topDataPos()>q()-m()},I=function(){var t,n,r,o,i,s;for(o=0,r=0,i=0,s=h.length;s>i&&(t=h[i],n=t.element.outerHeight(!0),l.topDataPos()+o+n<q()-m());i++)o+=n,r++,p=!1;return r>0?(l.topPadding(l.topPadding()+o),O(0,r),A+=r,e.log("clipped off top "+r+" top padding "+l.topPadding())):void 0},b=function(e,t){return N||(N=!0,U(!0)),1===R.push(e)?w(t):void 0},T=function(e,t){var n,r,o;return n=i.$new(),n[E]=t,r=e>A,n.$index=e,r&&n.$index--,o={scope:n},s(n,function(t){return o.element=t,r?e===D?(l.append(t),h.push(o)):(h[e-A].element.after(t),h.splice(e-A+1,0,o)):(l.prepend(t),h.unshift(o))}),{appended:r,wrapper:o}},g=function(e,t){var n;return e?l.bottomPadding(Math.max(0,l.bottomPadding()-t.element.outerHeight(!0))):(n=l.topPadding()-t.element.outerHeight(!0),n>=0?l.topPadding(n):G.scrollTop(G.scrollTop()+t.element.outerHeight(!0)))},d=function(t,n,o){var i;return i=function(){return e.log("top {actual="+l.topDataPos()+" visible from="+q()+" bottom {visible through="+f()+" actual="+l.bottomDataPos()+"}"),V()?b(!0,t):H()&&b(!1,t),o?o():void 0},n?r(function(){var e,t,r;for(t=0,r=n.length;r>t;t++)e=n[t],g(e.appended,e.wrapper);return i()}):i()},P=function(e,t){return d(e,t,function(){return R.shift(),0===R.length?(N=!1,U(!1)):w(e)})},w=function(t){var n;return n=R[0],n?h.length&&!V()?P(t):S.get(D,v,function(n){var r,o,i,s;if(o=[],0===n.length)$=!0,l.bottomPadding(0),e.log("appended: requested "+v+" records starting from "+D+" recieved: eof");else{for(I(),i=0,s=n.length;s>i;i++)r=n[i],o.push(T(++D,r));e.log("appended: requested "+v+" received "+n.length+" buffer size "+h.length+" first "+A+" next "+D)}return P(t,o)}):h.length&&!H()?P(t):S.get(A-v,v,function(n){var r,o,i,s;if(o=[],0===n.length)p=!0,l.topPadding(0),e.log("prepended: requested "+v+" records starting from "+(A-v)+" recieved: bof");else{for(y(),r=i=s=n.length-1;0>=s?0>=i:i>=0;r=0>=s?++i:--i)o.unshift(T(--A,n[r]));e.log("prepended: requested "+v+" received "+n.length+" buffer size "+h.length+" first "+A+" next "+D)}return P(t,o)})},M=function(){return n.$$phase||N?void 0:(d(!1),i.$apply())},G.bind("resize",M),B=function(){return n.$$phase||N?void 0:(d(!0),i.$apply())},G.bind("scroll",B),i.$watch(S.revision,function(){return F()}),k=S.scope?S.scope.$new():i.$new(),i.$on("$destroy",function(){return k.$destroy(),G.unbind("resize",M),G.unbind("scroll",B)}),k.$on("update.items",function(e,t,n){var r,o,i,s,a;if(angular.isFunction(t))for(o=function(e){return t(e.scope)},i=0,s=h.length;s>i;i++)r=h[i],o(r);else 0<=(a=t-A-1)&&a<h.length&&(h[t-A-1].scope[E]=n);
return null}),k.$on("delete.items",function(e,t){var n,r,o,i,s,a,c,u,l,g,p,f;if(angular.isFunction(t)){for(o=[],a=0,l=h.length;l>a;a++)r=h[a],o.unshift(r);for(s=function(e){return t(e.scope)?(O(o.length-1-n,o.length-n),D--):void 0},n=c=0,g=o.length;g>c;n=++c)i=o[n],s(i)}else 0<=(f=t-A-1)&&f<h.length&&(O(t-A-1,t-A),D--);for(n=u=0,p=h.length;p>u;n=++u)r=h[n],r.scope.$index=A+n;return d(!1)}),k.$on("insert.item",function(e,t,n){var r,o,i,s,a,c,u,l,g,p,f,m;if(o=[],angular.isFunction(t)){for(i=[],c=0,g=h.length;g>c;c++)n=h[c],i.unshift(n);for(a=function(e){var i,s,a,c,u;if(s=t(e.scope)){if(T=function(e,t){return T(e,t),D++},angular.isArray(s)){for(u=[],i=a=0,c=s.length;c>a;i=++a)n=s[i],u.push(o.push(T(r+i,n)));return u}return o.push(T(r,s))}},r=u=0,p=i.length;p>u;r=++u)s=i[r],a(s)}else 0<=(m=t-A-1)&&m<h.length&&(o.push(T(t,n)),D++);for(r=l=0,f=h.length;f>l;r=++l)n=h[r],n.scope.$index=A+r;return d(!1,o)})}}}}]),angular.module("ui.scrollfix",[]).directive("uiScrollfix",["$window",function(e){return{require:"^?uiScrollfixTarget",link:function(t,n,r,o){function i(){var t;if(angular.isDefined(e.pageYOffset))t=e.pageYOffset;else{var o=document.compatMode&&"BackCompat"!==document.compatMode?document.documentElement:document.body;t=o.scrollTop}!n.hasClass("ui-scrollfix")&&t>r.uiScrollfix?n.addClass("ui-scrollfix"):n.hasClass("ui-scrollfix")&&t<r.uiScrollfix&&n.removeClass("ui-scrollfix")}var s=n[0].offsetTop,a=o&&o.$element||angular.element(e);r.uiScrollfix?"string"==typeof r.uiScrollfix&&("-"===r.uiScrollfix.charAt(0)?r.uiScrollfix=s-parseFloat(r.uiScrollfix.substr(1)):"+"===r.uiScrollfix.charAt(0)&&(r.uiScrollfix=s+parseFloat(r.uiScrollfix.substr(1)))):r.uiScrollfix=s,a.on("scroll",i),t.$on("$destroy",function(){a.off("scroll",i)})}}}]).directive("uiScrollfixTarget",[function(){return{controller:["$element",function(e){this.$element=e}]}}]),angular.module("ui.showhide",[]).directive("uiShow",[function(){return function(e,t,n){e.$watch(n.uiShow,function(e){e?t.addClass("ui-show"):t.removeClass("ui-show")})}}]).directive("uiHide",[function(){return function(e,t,n){e.$watch(n.uiHide,function(e){e?t.addClass("ui-hide"):t.removeClass("ui-hide")})}}]).directive("uiToggle",[function(){return function(e,t,n){e.$watch(n.uiToggle,function(e){e?t.removeClass("ui-hide").addClass("ui-show"):t.removeClass("ui-show").addClass("ui-hide")})}}]),angular.module("ui.unique",[]).filter("unique",["$parse",function(e){return function(t,n){if(n===!1)return t;if((n||angular.isUndefined(n))&&angular.isArray(t)){var r=[],o=angular.isString(n)?e(n):function(e){return e},i=function(e){return angular.isObject(e)?o(e):e};angular.forEach(t,function(e){for(var t=!1,n=0;n<r.length;n++)if(angular.equals(i(r[n]),i(e))){t=!0;break}t||r.push(e)}),t=r}return t}}]),angular.module("ui.validate",[]).directive("uiValidate",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){function o(t){return angular.isString(t)?void e.$watch(t,function(){angular.forEach(s,function(e){e(r.$modelValue)})}):angular.isArray(t)?void angular.forEach(t,function(t){e.$watch(t,function(){angular.forEach(s,function(e){e(r.$modelValue)})})}):void(angular.isObject(t)&&angular.forEach(t,function(t,n){angular.isString(t)&&e.$watch(t,function(){s[n](r.$modelValue)}),angular.isArray(t)&&angular.forEach(t,function(t){e.$watch(t,function(){s[n](r.$modelValue)})})}))}var i,s={},a=e.$eval(n.uiValidate);a&&(angular.isString(a)&&(a={validator:a}),angular.forEach(a,function(t,n){i=function(o){var i=e.$eval(t,{$value:o});return angular.isObject(i)&&angular.isFunction(i.then)?(i.then(function(){r.$setValidity(n,!0)},function(){r.$setValidity(n,!1)}),o):i?(r.$setValidity(n,!0),o):void r.$setValidity(n,!1)},s[n]=i,r.$formatters.push(i),r.$parsers.push(i)}),n.uiValidateWatch&&o(e.$eval(n.uiValidateWatch)))}}}),angular.module("ui.utils",["ui.event","ui.format","ui.highlight","ui.include","ui.indeterminate","ui.inflector","ui.jq","ui.keypress","ui.mask","ui.reset","ui.route","ui.scrollfix","ui.scroll","ui.scroll.jqlite","ui.showhide","ui.unique","ui.validate"]);